function isUndefined(object){return"undefined"==typeof object}function isUndefinedOrNull(object){return"undefined"==typeof object||null===object}function onMouseUpdate(e){absoluteXposition=e.pageX,absoluteYposition=e.pageY}function readMP4Info(data){var infos={absoluteTime:0,pts:0,timeScale:0,duration:0,rate:0},pos=60;return infos.absoluteTime=new DataView(data,pos,pos+8).getUint32(0),infos.absoluteTime=1e3*(infos.absoluteTime-2082844800),pos+=8,infos.pts=new DataView(data,pos,pos+4).getUint32(0),pos+=4,infos.timeScale=new DataView(data,pos,pos+4).getUint32(0),infos.timeScale=1/infos.timeScale,pos+=4,infos.duration=new DataView(data,pos,pos+4).getUint32(0),pos+=4,infos.rate=new DataView(data,pos,pos+4).getUint32(0),infos}function readNCC(bytes,n){for(var res="",i=0;i<n;i++)res+=String.fromCharCode(bytes[i]);return res}!function(){var initializing=!1,fnTest=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;this.BaseClass=function(){},BaseClass.extend=function(prop){function BaseClass(){!initializing&&this.initialize&&this.initialize.apply(this,arguments)}var _super=this.prototype;initializing=!0;var prototype=new this;initializing=!1;for(var name in prop)"function"==typeof prop[name]&&"function"==typeof _super[name]&&fnTest.test(prop[name])?prototype[name]=function(name,fn){return function(){var tmp=this._super;this._super=_super[name];var ret=fn.apply(this,arguments);return this._super=tmp,ret}}(name,prop[name]):prototype[name]=prop[name];return BaseClass.prototype=prototype,BaseClass.prototype.constructor=BaseClass,BaseClass.extend=arguments.callee,BaseClass}}();var OSH={version:"dev"};window.OSH=OSH,window.OSH.Video={},window.OSH.UI={},window.OSH.UI.View={},window.OSH.Styler={},window.OSH.ContextMenu={},window.OSH.DataReceiver={},window.OSH.DataConnector={},window.OSH.Utils={},window.OSH.DataSender={},function(){var ua=navigator.userAgent.toLowerCase(),doc=document.documentElement,ie="ActiveXObject"in window,webkit=ua.indexOf("webkit")!==-1,phantomjs=ua.indexOf("phantom")!==-1,android23=ua.search("android [23]")!==-1,chrome=ua.indexOf("chrome")!==-1,gecko=ua.indexOf("gecko")!==-1&&!webkit&&!window.opera&&!ie,win=0===navigator.platform.indexOf("Win"),mobile="undefined"!=typeof orientation||ua.indexOf("mobile")!==-1,msPointer=!window.PointerEvent&&window.MSPointerEvent,pointer=window.PointerEvent||msPointer,ie3d=ie&&"transition"in doc.style,webkit3d="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!android23,gecko3d="MozPerspective"in doc.style,opera12="OTransition"in doc.style,touch=!window.L_NO_TOUCH&&(pointer||"ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch);OSH.Browser={ie:ie,ielt9:ie&&!document.addEventListener,edge:"msLaunchUri"in navigator&&!("documentMode"in document),webkit:webkit,gecko:gecko,android:ua.indexOf("android")!==-1,android23:android23,chrome:chrome,safari:!chrome&&ua.indexOf("safari")!==-1,win:win,ie3d:ie3d,webkit3d:webkit3d,gecko3d:gecko3d,opera12:opera12,any3d:!window.L_DISABLE_3D&&(ie3d||webkit3d||gecko3d)&&!opera12&&!phantomjs,mobile:mobile,mobileWebkit:mobile&&webkit,mobileWebkit3d:mobile&&webkit3d,mobileOpera:mobile&&window.opera,mobileGecko:mobile&&gecko,touch:!!touch,msPointer:!!msPointer,pointer:!!pointer,retina:(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI)>1}}();var MAX_LONG=Math.pow(2,53)+1;OSH.Utils=function(){},OSH.Utils.randomUUID=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=16*Math.random()|0,v="x"==c?r:3&r|8;return v.toString(16)})},OSH.Utils.stampUUID=function(obj){return obj._osh_id=obj._osh_id||OSH.Utils.randomUUID(),obj._osh_id},OSH.Utils.jsonix_XML2JSON=function(xmlStr){var context=(SOS_2_0_Module_Factory(),new Jsonix.Context([XLink_1_0,IC_2_0,SMIL_2_0,SMIL_2_0_Language,GML_3_1_1,SWE_1_0_1,GML_3_2_1,OWS_1_1_0,SWE_2_0,SWES_2_0,WSN_T_1,WS_Addr_1_0_Core,OM_2_0,ISO19139_GMD_20070417,ISO19139_GCO_20070417,ISO19139_GSS_20070417,ISO19139_GTS_20070417,ISO19139_GSR_20070417,Filter_2_0,SensorML_2_0,SOS_2_0])),unmarshaller=context.createUnmarshaller(),jsonData=unmarshaller.unmarshalString(xmlStr);return jsonData},OSH.Utils.ParseBytes=function(buffer,offset,type){var view=new DataView(buffer),typeMap={double:function(offset){return{val:view.getFloat64(offset),bytes:8}},float64:function(offset){return{val:view.getFloat64(offset),bytes:8}},float32:function(offset){return{val:view.getFloat32(offset),bytes:4}},signedByte:function(offset){return{val:view.getInt8(offset),bytes:1}},signedInt:function(offset){return{val:view.getInt32(offset),bytes:4}},signedShort:function(offset){return{val:view.getInt16(offset),bytes:2}},unsignedByte:function(offset){return{val:view.getUint8(offset),bytes:1}},unsignedInt:function(offset){return{val:view.getUint32(offset),bytes:4}},unsignedShort:function(offset){return{val:view.getUint16(offset),bytes:2}}};return typeMap[type](offset)},OSH.Utils.ReadData=function(struct,data,offsetBytes){for(var offset=offsetBytes,i=0;i<struct.fields.length;i++){var currFieldStruct=struct.fields[i];if("undefined"!=typeof currFieldStruct.type&&null!==currFieldStruct.type){var ret=OSH.Utils.ParseBytes(data,offset,currFieldStruct.type);currFieldStruct.val=ret.val,offset+=ret.bytes}else if("undefined"!=typeof currFieldStruct.count&&null!==currFieldStruct.count){if(isNaN(currFieldStruct.count)){var id=currFieldStruct.count,fieldName=struct.id2FieldMap[id];currFieldStruct.count=struct.findFieldByName(fieldName).val}for(var c=0;c<currFieldStruct.count;c++)for(var j=0;j<currFieldStruct.fields.length;j++){var field=JSON.parse(JSON.stringify(currFieldStruct.fields[j]));offset=OSH.Utils.ReadData(field,data,offset),currFieldStruct.val.push(field)}}}return offset},OSH.Utils.GetResultObject=function(resultStructure){for(var result={},i=0;i<resultStructure.fields.length;i++)if("undefined"!=typeof resultStructure.fields[i].count){result[resultStructure.fields[i].name]=[];for(var c=0;c<resultStructure.fields[i].count;c++){for(var item={},k=0;k<resultStructure.fields[i].val[c].fields.length;k++)item[resultStructure.fields[i].val[c].fields[k].name]=resultStructure.fields[i].val[c].fields[k].val;result[resultStructure.fields[i].name].push(item)}}else result[resultStructure.fields[i].name]=resultStructure.fields[i].val;return result},OSH.Utils.isOpera=function(){return!!window.opr&&!!opr.addons||!!window.opera||navigator.userAgent.indexOf(" OPR/")>=0},OSH.Utils.isFirefox=function(){return"undefined"!=typeof InstallTrigger},OSH.Utils.isSafari=function(){return Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor")>0},OSH.Utils.isIE=function(){return!!document.documentMode},OSH.Utils.isChrome=function(){return!!window.chrome&&!!window.chrome.webstore},OSH.Utils.isBlink=function(){return(isChrome||isOpera)&&!!window.CSS};var absoluteXposition=null,absoluteYposition=null;document.addEventListener("mousemove",onMouseUpdate,!1),document.addEventListener("mouseenter",onMouseUpdate,!1),OSH.Utils.getXCursorPosition=function(){return absoluteXposition},OSH.Utils.getYCursorPosition=function(){return absoluteYposition},OSH.Utils.isArrayIntersect=function(a,b){return a.intersect(b).length>0},OSH.Utils.isElement=function(o){return"object"==typeof HTMLElement?o instanceof HTMLElement:o&&"object"==typeof o&&null!==o&&1===o.nodeType&&"string"==typeof o.nodeName},OSH.Utils.isWebWorker=function(){return"undefined"!=typeof Worker},OSH.Utils.takeScreeshot=function(div){},OSH.Utils.removeCss=function(div,css){var divCss=div.className;css=divCss.replace(css,""),div.className=css},OSH.Utils.addCss=function(div,css){div.setAttribute("class",div.className+" "+css)};var eventsKey="_osh_events";OSH.DomEvent={on:function(obj,types,fn,context){if("object"==typeof types)for(var type in types)this._on(obj,type,types[type],fn);else{types=types.trim().split(/\s+/);for(var i=0,len=types.length;i<len;i++)this._on(obj,types[i],fn,context)}return this},off:function(obj,types,fn,context){if("object"==typeof types)for(var type in types)this._off(obj,type,types[type],fn);else{types=types.trim().split(/\s+/);for(var i=0,len=types.length;i<len;i++)this._off(obj,types[i],fn,context)}return this},_on:function(obj,type,fn,context){var id=type+OSH.Utils.stampUUID(fn)+(context?"_"+OSH.Utils.stampUUID(context):"");if(obj[eventsKey]&&obj[eventsKey][id])return this;var handler=function(e){return fn.call(context||obj,e||window.event)},originalHandler=handler;return OSH.Browser.pointer&&0===type.indexOf("touch")?this.addPointerListener(obj,type,handler,id):OSH.Browser.touch&&"dblclick"===type&&this.addDoubleTapListener?this.addDoubleTapListener(obj,handler,id):"addEventListener"in obj?"mousewheel"===type?obj.addEventListener("onwheel"in obj?"wheel":"mousewheel",handler,!1):"mouseenter"===type||"mouseleave"===type?(handler=function(e){e=e||window.event,OSH.DomEvent._isExternalTarget(obj,e)&&originalHandler(e)},obj.addEventListener("mouseenter"===type?"mouseover":"mouseout",handler,!1)):("click"===type&&OSH.Browser.android&&(handler=function(e){return OSH.DomEvent._filterClick(e,originalHandler)}),obj.addEventListener(type,handler,!1)):"attachEvent"in obj&&obj.attachEvent("on"+type,handler),obj[eventsKey]=obj[eventsKey]||{},obj[eventsKey][id]=handler,this},_off:function(obj,type,fn,context){var id=type+OSH.Utils.stampUUID(fn)+(context?"_"+OSH.Utils.stampUUID(context):""),handler=obj[eventsKey]&&obj[eventsKey][id];return handler?(OSH.Browser.pointer&&0===type.indexOf("touch")?this.removePointerListener(obj,type,id):OSH.Browser.touch&&"dblclick"===type&&this.removeDoubleTapListener?this.removeDoubleTapListener(obj,id):"removeEventListener"in obj?"mousewheel"===type?obj.removeEventListener("onwheel"in obj?"wheel":"mousewheel",handler,!1):obj.removeEventListener("mouseenter"===type?"mouseover":"mouseleave"===type?"mouseout":type,handler,!1):"detachEvent"in obj&&obj.detachEvent("on"+type,handler),obj[eventsKey][id]=null,this):this},stopPropagation:function(e){return e.stopPropagation?e.stopPropagation():e.originalEvent?e.originalEvent._stopped=!0:e.cancelBubble=!0,OSH.DomEvent._skipped(e),this},disableScrollPropagation:function(el){return OSH.DomEvent.on(el,"mousewheel",OSH.DomEvent.stopPropagation)},disableClickPropagation:function(el){var stop=OSH.DomEvent.stopPropagation,start_txt=OSH.Browser.touch?["touchstart","mousedown"]:["mousedown"];return OSH.DomEvent.on(el,start_txt.join(" "),stop),OSH.DomEvent.on(el,{click:OSH.DomEvent._fakeStop,dblclick:stop})},preventDefault:function(e){return e.preventDefault?e.preventDefault():e.returnValue=!1,this},stop:function(e){return OSH.DomEvent.preventDefault(e).stopPropagation(e)},getMousePosition:function(e,container){if(!container){var ptContainer={x:e.clientX,y:e.clientY};return ptContainer}var rect=container.getBoundingClientRect(),ptPage={x:e.clientX-rect.left-container.clientLeft,y:e.clientY-rect.top-container.clientTop};return ptPage},_wheelPxFactor:OSH.Browser.win&&OSH.Browser.chrome?2:OSH.Browser.gecko?window.devicePixelRatio:1,getWheelDelta:function(e){return OSH.Browser.edge?e.wheelDeltaY/2:e.deltaY&&0===e.deltaMode?-e.deltaY/OSH.DomEvent._wheelPxFactor:e.deltaY&&1===e.deltaMode?20*-e.deltaY:e.deltaY&&2===e.deltaMode?60*-e.deltaY:e.deltaX||e.deltaZ?0:e.wheelDelta?(e.wheelDeltaY||e.wheelDelta)/2:e.detail&&Math.abs(e.detail)<32765?20*-e.detail:e.detail?e.detail/-32765*60:0},_skipEvents:{},_fakeStop:function(e){OSH.DomEvent._skipEvents[e.type]=!0},_skipped:function(e){var skipped=this._skipEvents[e.type];return this._skipEvents[e.type]=!1,skipped},_isExternalTarget:function(el,e){var related=e.relatedTarget;if(!related)return!0;try{for(;related&&related!==el;)related=related.parentNode}catch(err){return!1}return related!==el},_filterClick:function(e,handler){var timeStamp=e.timeStamp||e.originalEvent&&e.originalEvent.timeStamp,elapsed=OSH.DomEvent._lastClick&&timeStamp-OSH.DomEvent._lastClick;return elapsed&&elapsed>100&&elapsed<500||e.target._simulatedClick&&!e._simulated?void OSH.DomEvent.stop(e):(OSH.DomEvent._lastClick=timeStamp,void handler(e))}},OSH.DomEvent.addListener=OSH.DomEvent.on,OSH.DomEvent.removeListener=OSH.DomEvent.off,OSH.MapEvent=BaseClass.extend({initialize:function(){this.mapEvents={}},observe:function(eventName,fnCallback){"undefined"!=typeof eventName&&"undefined"!=typeof fnCallback&&(eventName in this.mapEvents||(this.mapEvents[eventName]=[]),this.mapEvents[eventName].push(fnCallback))},fire:function(eventName,properties){if("undefined"!=typeof eventName&&eventName in this.mapEvents)for(var fnCallbackArr=this.mapEvents[eventName],i=0;i<fnCallbackArr.length;i++)fnCallbackArr[i](properties)}}),OSH.EventManager=function(){};var mapEvent=new OSH.MapEvent;OSH.EventManager.fire=function(eventName,properties){mapEvent.fire("osh:"+eventName,properties)},OSH.EventManager.observe=function(eventName,fnCallback){mapEvent.observe("osh:"+eventName,fnCallback)},OSH.EventManager.observeDiv=function(divId,eventName,fnCallback){elem=document.getElementById(divId),elem.addEventListener(eventName,fnCallback)},OSH.EventManager.EVENT={DATA:"data",SYNC_DATA:"syncData",SELECT_VIEW:"selectView",CONTEXT_MENU:"contextMenu",SHOW_VIEW:"showView",CONNECT_DATASOURCE:"connectDataSource",DISCONNECT_DATASOURCE:"disconnectDataSource",DATASOURCE_UPDATE_TIME:"updateDataSourceTime",CURRENT_MASTER_TIME:"currentMasterTime",UAV_TAKEOFF:"uav:takeoff",UAV_GOTO:"uav:goto",UAV_LOOKAT:"uav:lookat",UAV_LAND:"uav:land",UAV_ORBIT:"uav:orbit",LOADING_START:"loading:start",LOADING_STOP:"loading:stop",ADD_VIEW_ITEM:"addViewItem",RESIZE:"resize"};var INITIAL_BUFFERING_TIME=3e3,BUFFER_STATUS={CANCEL:"cancel",START:"start",STOP:"stop",NOT_START_YET:"notStartYet"};OSH.Buffer=BaseClass.extend({initialize:function(options){this.buffers={},this.replayFactor=1,"undefined"!=typeof options&&"undefined"!=typeof options.replayFactor&&(this.replayFactor=options.replayFactor),this.stop=!1,this.bufferingState=!1},startObservers:function(){this.observeId=OSH.Utils.randomUUID(),this.boundHandlerMethod=this.push.bind(this),OSH.EventManager.observe(OSH.EventManager.EVENT.DATA,this.boundHandlerMethod,this.observeId)},stopObservers:function(){"undefined"==typeof this.observeId&&null===this.observeId||(OSH.EventManager.observe(OSH.EventManager.EVENT.DATA,this.boundHandlerMethod,this.observeId),this.observeId=void 0)},start:function(){this.stop=!1,this.startObservers(),this.startRealTime=(new Date).getTime(),this.processSyncData()},stop:function(){this.stopObservers(),this.stop=!0},cancelAll:function(){for(var dataSourceId in this.buffers)this.cancelDataSource(dataSourceId)},cancelDataSource:function(dataSourceId){this.buffers[dataSourceId].buffer=[],this.buffers[dataSourceId].status=BUFFER_STATUS.CANCEL},startDataSource:function(dataSourceId){this.buffers[dataSourceId].status=BUFFER_STATUS.NOT_START_YET,this.buffers[dataSourceId].lastRecordTime=Date.now()},startAll:function(){for(var dataSourceId in this.buffers)this.startDataSource(dataSourceId)},addDataSource:function(dataSourceId,options){this.buffers[dataSourceId]={buffer:[],syncMasterTime:!1,bufferingTime:INITIAL_BUFFERING_TIME,timeOut:3e3,lastRecordTime:Date.now(),status:BUFFER_STATUS.NOT_START_YET,name:"undefined"},"undefined"!=typeof options&&("undefined"!=typeof options.syncMasterTime&&(this.buffers[dataSourceId].syncMasterTime=options.syncMasterTime),"undefined"!=typeof options.bufferingTime&&(this.buffers[dataSourceId].bufferingTime=options.bufferingTime),"undefined"!=typeof options.timeOut&&(this.buffers[dataSourceId].timeOut=options.timeOut),"undefined"!=typeof options.name&&(this.buffers[dataSourceId].name=options.name))},addEntity:function(entity,options){if("undefined"!=typeof entity.dataSources)for(var i=0;i<entity.dataSources.length;i++)this.addDataSource(entity.dataSources[i],options)},push:function(event){var dataSourceId=event.dataSourceId,currentBufferObj=this.buffers[dataSourceId],sync=currentBufferObj.syncMasterTime;sync&&event.data.timeStamp<this.currentTime||currentBufferObj.status!=BUFFER_STATUS.CANCEL&&(currentBufferObj.status==BUFFER_STATUS.NOT_START_YET&&(currentBufferObj.startRelativeTime=event.data.timeStamp,currentBufferObj.startRelativeRealTime=(new Date).getTime(),currentBufferObj.status=BUFFER_STATUS.START),currentBufferObj.buffer.push(event.data),currentBufferObj.lastRecordTime=Date.now(),sync||this.processData(currentBufferObj,dataSourceId))},processSyncData:function(){if(!this.bufferingState){var minTimeStampBufferObj=null,minTimeStampDSId=null,minTimeStamp=MAX_LONG,currentBufferObj=null;for(var dataSourceId in this.buffers)if(currentBufferObj=this.buffers[dataSourceId],(currentBufferObj.status==BUFFER_STATUS.START||currentBufferObj.status==BUFFER_STATUS.NOT_START_YET)&&currentBufferObj.syncMasterTime)if(0===currentBufferObj.buffer.length){var waitTime=currentBufferObj.timeOut-(Date.now()-currentBufferObj.lastRecordTime);if(waitTime>0)return void window.setTimeout(function(){this.processSyncData()}.bind(this),waitTime/10)}else currentBufferObj.buffer[0].timeStamp<minTimeStamp&&(minTimeStampBufferObj=currentBufferObj,minTimeStampDSId=dataSourceId,minTimeStamp=currentBufferObj.buffer[0].timeStamp);null!==minTimeStampBufferObj?(this.currentTime=minTimeStamp,this.processData(minTimeStampBufferObj,minTimeStampDSId,function(){this.processSyncData()}.bind(this))):window.setTimeout(function(){this.processSyncData()}.bind(this),1e3)}},processData:function(bufferObj,dataSourceId,fnEndTimeout){var startRelativeTime=bufferObj.startRelativeTime,elapsedTime=(new Date).getTime()-bufferObj.startRelativeRealTime,data=bufferObj.buffer.shift(),waitTime=(data.timeStamp-startRelativeTime)/this.replayFactor-elapsedTime;bufferObj.startRelativeTime=data.timeStamp,bufferObj.startRelativeRealTime=(new Date).getTime(),waitTime>0?window.setTimeout(function(){this.dispatchData(dataSourceId,data),"undefined"!=typeof fnEndTimeout&&fnEndTimeout()}.bind(this),waitTime):(this.dispatchData(dataSourceId,data),"undefined"!=typeof fnEndTimeout&&fnEndTimeout())},dispatchData:function(dataSourceId,data){var bufObj=this.buffers[dataSourceId];bufObj.status!=BUFFER_STATUS.CANCEL&&(bufObj.syncMasterTime&&OSH.EventManager.fire(OSH.EventManager.EVENT.CURRENT_MASTER_TIME,{timeStamp:data.timeStamp}),OSH.EventManager.fire(OSH.EventManager.EVENT.DATA+"-"+dataSourceId,{data:data}))},buffering:function(name,bufferingTime){OSH.EventManager.fire(OSH.EventManager.EVENT.LOADING_START,{name:name}),this.bufferingState=!0,window.setTimeout(function(){this.bufferingState=!1,OSH.EventManager.fire(OSH.EventManager.EVENT.LOADING_STOP),this.processSyncData()}.bind(this),bufferingTime)}}),OSH.DataConnector.DataConnector=BaseClass.extend({initialize:function(url){this.url=url,this.id="DataConnector-"+OSH.Utils.randomUUID()},getId:function(){return this.id},getUrl:function(){return this.url}}),OSH.DataConnector.AjaxConnector=OSH.DataConnector.DataConnector.extend({sendRequest:function(request){var xmlhttp=new XMLHttpRequest;xmlhttp.open("POST",this.getUrl(),!0),xmlhttp.setRequestHeader("Content-Type","text/xml"),xmlhttp.send(request),xmlhttp.onreadystatechange=function(){4==xmlhttp.readyState&&200==xmlhttp.status&&console.log("ici")}.bind(this)},onError:function(event){},onSuccess:function(event){}}),OSH.DataConnector.WebSocketDataConnector=OSH.DataConnector.DataConnector.extend({connect:function(){if(!this.init){if(OSH.Utils.isWebWorker()){var url=this.getUrl(),blobURL=URL.createObjectURL(new Blob(["(",function(){function init(url){ws=new WebSocket(url),ws.binaryType="arraybuffer",ws.onmessage=function(event){event.data.byteLength>0&&self.postMessage(event.data)},ws.onerror=function(event){ws.close()}}function close(){ws.close()}var ws=null;self.onmessage=function(e){"close"==e.data?close():init(e.data)}}.toString(),")()"],{type:"application/javascript"}));this.worker=new Worker(blobURL),this.worker.postMessage(url),this.worker.onmessage=function(e){this.onMessage(e.data)}.bind(this),URL.revokeObjectURL(blobURL)}else this.ws=new WebSocket(this.getUrl()),this.ws.binaryType="arraybuffer",this.ws.onmessage=function(event){event.data.byteLength>0&&this.onMessage(event.data)}.bind(this),this.ws.onerror=function(event){this.ws.close()}.bind(this);this.init=!0}},disconnect:function(){OSH.Utils.isWebWorker()&&null!=this.worker?(this.worker.postMessage("close"),this.worker.terminate(),this.init=!1):null!=this.ws&&(this.ws.close(),this.init=!1)},onMessage:function(data){},close:function(){this.disconnect()}}),OSH.DataReceiver.DataSource=BaseClass.extend({initialize:function(name,properties){this.id="DataSource-"+OSH.Utils.randomUUID(),this.name=name,this.properties=properties,this.timeShift=0,this.connected=!1,this.initDataSource(properties)},initDataSource:function(properties){"undefined"!=typeof properties.timeShift&&(this.timeShift=properties.timeShift),"undefined"!=typeof properties.syncMasterTime?this.syncMasterTime=properties.syncMasterTime:this.syncMasterTime=!1,"undefined"!=typeof properties.bufferingTime&&(this.bufferingTime=properties.bufferingTime),"undefined"!=typeof properties.timeOut&&(this.timeOut=properties.timeOut),"ws"==properties.protocol&&(this.connector=new OSH.DataConnector.WebSocketDataConnector(this.buildUrl(properties)),this.connector.onMessage=this.onMessage.bind(this))},disconnect:function(){this.connector.disconnect(),this.connected=!1,OSH.EventManager.fire(OSH.EventManager.EVENT.DATA+"-"+this.id,{dataSourceId:this.id,reset:!0})},connect:function(){this.connector.connect(),this.connected=!0},onMessage:function(data){var data={timeStamp:this.parseTimeStamp(data)+this.timeShift,data:this.parseData(data)};this.onData(data)},parseTimeStamp:function(data){return(new Date).getTime()},parseData:function(data){return data},onData:function(data){},getId:function(){return this.id},getName:function(){return this.name},buildUrl:function(properties){var url="";url+=properties.protocol+"://",url+=properties.endpointUrl+"?",url+="service="+properties.service+"&",url+="version=2.0&",url+="request=GetResult&",url+="offering="+properties.offeringID+"&",url+="observedProperty="+properties.observedProperty+"&";var startTime=properties.startTime,endTime=properties.endTime;return"now"!==startTime&&0!=this.timeShift&&"urn:android:device:060693280a28e015-sos"!==properties.offeringID&&(startTime=new Date(Date.parse(startTime)-this.timeShift).toISOString(),endTime=new Date(Date.parse(endTime)-this.timeShift).toISOString()),url+="temporalFilter=phenomenonTime,"+startTime+"/"+endTime+"&",properties.replaySpeed&&(url+="replaySpeed="+properties.replaySpeed),properties.responseFormat&&(url+="&responseFormat="+properties.responseFormat),url}}),OSH.DataReceiver.EulerOrientation=OSH.DataReceiver.DataSource.extend({parseTimeStamp:function(data){var rec=String.fromCharCode.apply(null,new Uint8Array(data)),tokens=rec.trim().split(","),t=new Date(tokens[0]).getTime();return t},parseData:function(data){var rec=String.fromCharCode.apply(null,new Uint8Array(data)),tokens=rec.trim().split(","),yaw=parseFloat(tokens[1]),pitch=parseFloat(tokens[2]),roll=parseFloat(tokens[3]);return{pitch:pitch,roll:roll,heading:yaw}}}),OSH.DataReceiver.LatLonAlt=OSH.DataReceiver.DataSource.extend({parseTimeStamp:function(data){var rec=String.fromCharCode.apply(null,new Uint8Array(data)),tokens=rec.trim().split(","),t=new Date(tokens[0]).getTime();return t},parseData:function(data){var rec=String.fromCharCode.apply(null,new Uint8Array(data)),tokens=rec.trim().split(","),lat=parseFloat(tokens[1]),lon=parseFloat(tokens[2]),alt=parseFloat(tokens[3]);return{lat:lat,lon:lon,alt:alt}}}),OSH.DataReceiver.Nexrad=OSH.DataReceiver.DataSource.extend({parseTimeStamp:function(data){var rec=String.fromCharCode.apply(null,new Uint8Array(data)),tokens=rec.trim().split(",");return new Date(tokens[0]).getTime()},parseData:function(data){var rec=String.fromCharCode.apply(null,new Uint8Array(data)),tokens=rec.trim().split(","),el=parseFloat(tokens[2]),az=parseFloat(tokens[3]),rangeToCenterOfFirstRefGate=parseFloat(tokens[4]),refGateSize=parseFloat(tokens[5]),numRefGates=parseInt(tokens[6]),rangeToCenterOfFirstVelGate=parseFloat(tokens[7]),velGateSize=parseFloat(tokens[8]),numVelGates=parseInt(tokens[9]),rangeToCenterOfFirstSwGate=parseFloat(tokens[10]),swGateSize=parseFloat(tokens[11]),numSwGates=parseInt(tokens[12]),i=13,refData=[];for(count=0;count<numRefGates;count++)refData.push(parseFloat(tokens[i++]));var velData=[];for(count=0;count<numVelGates;count++)velData.push(parseFloat(tokens[i++]));var swData=[];for(count=0;count<numSwGates;count++)swData.push(parseFloat(tokens[i++]));return{elevation:el,azimuth:az,rangeToCenterOfFirstRefGate:rangeToCenterOfFirstRefGate,refGateSize:refGateSize,rangeToCenterOfFirstVelGate:rangeToCenterOfFirstVelGate,velGateSize:velGateSize,rangeToCenterOfFirstSwGate:rangeToCenterOfFirstSwGate,swGateSize:swGateSize,reflectivity:refData,velocity:velData,spectrumWidth:swData}}}),OSH.DataReceiver.DataSourceUAHWeather=OSH.DataReceiver.DataSource.extend({parseTimeStamp:function(data){var rec=String.fromCharCode.apply(null,new Uint8Array(data)),tokens=rec.trim().split(",");return new Date(tokens[0]).getTime()},parseData:function(data){var rec=String.fromCharCode.apply(null,new Uint8Array(data)),tokens=rec.trim().split(","),airPres=parseFloat(tokens[1]),airTemp=parseFloat(tokens[2]),humidity=parseFloat(tokens[3]),windSpeed=parseFloat(tokens[4]),windDir=parseFloat(tokens[5]),rainCnt=parseFloat(tokens[6]);return{airPres:airPres,airTemp:airTemp,humidity:humidity,windSpeed:windSpeed,windDir:windDir,rainCnt:rainCnt}}}),OSH.DataReceiver.OrientationQuaternion=OSH.DataReceiver.DataSource.extend({parseTimeStamp:function(data){var rec=String.fromCharCode.apply(null,new Uint8Array(data)),tokens=rec.trim().split(",");return new Date(tokens[0]).getTime()},parseData:function(data){var rec=String.fromCharCode.apply(null,new Uint8Array(data)),tokens=rec.trim().split(","),qx=parseFloat(tokens[1]),qy=parseFloat(tokens[2]),qz=parseFloat(tokens[3]),qw=parseFloat(tokens[4]),x=0,y=0,z=-1,ix=qw*x+qy*z-qz*y,iy=qw*y+qz*x-qx*z,iz=qw*z+qx*y-qy*x,iw=-qx*x-qy*y-qz*z;xp=ix*qw+iw*-qx+iy*-qz-iz*-qy,yp=iy*qw+iw*-qy+iz*-qx-ix*-qz,zp=iz*qw+iw*-qz+ix*-qy-iy*-qx;var yaw=90-180/Math.PI*Math.atan2(yp,xp);return{heading:yaw,roll:null,pitch:null}}}),OSH.DataReceiver.VideoH264=OSH.DataReceiver.DataSource.extend({initialize:function(name,properties,options){this._super(name,properties,options)},parseTimeStamp:function(data){return 1e3*new DataView(data).getFloat64(0,!1)},parseData:function(data){var len=data.byteLength;return new Uint8Array(data,12,len-12)}}),OSH.DataReceiver.VideoMjpeg=OSH.DataReceiver.DataSource.extend({initialize:function(name,properties,options){this._super(name,properties,options)},parseTimeStamp:function(data){return 1e3*new DataView(data).getFloat64(0,!1)},parseData:function(data){var imgBlob=new Blob([data]),blobURL=window.URL.createObjectURL(imgBlob.slice(12));return blobURL}}),OSH.DataReceiver.VideoMp4=OSH.DataReceiver.DataSource.extend({initialize:function(name,properties,options){this._super(name,properties,options),this.absoluteTime=-1},parseTimeStamp:function(data){if(this.absoluteTime==-1){var infos=readMP4Info(data);return this.absoluteTime=infos.absoluteTime,this.timeScale=infos.timeScale,this.absoluteTime}var infos=readMP4Info(data);return 1e3*infos.pts*this.timeScale+this.absoluteTime}}),OSH.DataReceiver.Chart=OSH.DataReceiver.DataSource.extend({parseTimeStamp:function(data){var rec=String.fromCharCode.apply(null,new Uint8Array(data)),tokens=rec.trim().split(","),t=new Date(tokens[0]).getTime();return t},parseData:function(data){var rec=String.fromCharCode.apply(null,new Uint8Array(data)),tokens=rec.trim().split(",");return tokens.shift(),tokens}}),OSH.DataReceiver.DataReceiverController=BaseClass.extend({initialize:function(options){this.options=options,this.initBuffer(),this.dataSourcesIdToDataSources={},OSH.EventManager.observe(OSH.EventManager.EVENT.CONNECT_DATASOURCE,function(event){for(var eventDataSourcesIds=event.dataSourcesId,i=0;i<eventDataSourcesIds.length;i++){var id=eventDataSourcesIds[i];id in this.dataSourcesIdToDataSources&&(this.dataSourcesIdToDataSources[id].syncMasterTime&&this.updateDataSourceTime(id,new Date(this.buffer.currentTime).toISOString()),this.dataSourcesIdToDataSources[id].connect(),this.buffer.startDataSource(id))}}.bind(this)),OSH.EventManager.observe(OSH.EventManager.EVENT.DISCONNECT_DATASOURCE,function(event){for(var eventDataSourcesIds=event.dataSourcesId,i=0;i<eventDataSourcesIds.length;i++){var id=eventDataSourcesIds[i];id in this.dataSourcesIdToDataSources&&(this.dataSourcesIdToDataSources[id].disconnect(),this.buffer.cancelDataSource(id))}}.bind(this)),OSH.EventManager.observe(OSH.EventManager.EVENT.DATASOURCE_UPDATE_TIME,function(event){var dataSourcesToReconnect=[];for(var id in this.dataSourcesIdToDataSources){var dataSrc=this.dataSourcesIdToDataSources[id];dataSrc.syncMasterTime&&dataSrc.connected&&(dataSrc.disconnect(),this.buffer.cancelDataSource(id),dataSourcesToReconnect.push(id))}this.buffer.currentTime=Date.parse(event.startTime);for(var i=0;i<dataSourcesToReconnect.length;i++){var id=dataSourcesToReconnect[i],dataSrc=this.dataSourcesIdToDataSources[id];this.updateDataSourceTime(id,event.startTime,event.endTime),dataSrc.connect(),this.buffer.startDataSource(id)}}.bind(this))},updateDataSourceTime:function(id,startTime,endTime){var dataSource=this.dataSourcesIdToDataSources[id],props=dataSource.properties,options=dataSource.options;"undefined"!=typeof startTime&&(props.startTime=startTime),"undefined"!=typeof endTime&&(props.endTime=endTime),dataSource.initDataSource(props,options)},initBuffer:function(){this.buffer=new OSH.Buffer(this.options)},addEntity:function(entity,options){if("undefined"!=typeof entity.dataSources)for(var i=0;i<entity.dataSources.length;i++)this.addDataSource(entity.dataSources[i],options)},addDataSource:function(dataSource,options){this.dataSourcesIdToDataSources[dataSource.id]=dataSource,this.buffer.addDataSource(dataSource.id,{name:dataSource.name,syncMasterTime:dataSource.syncMasterTime,bufferingTime:dataSource.bufferingTime,timeOut:dataSource.timeOut}),dataSource.onData=function(data){this.buffer.push({dataSourceId:dataSource.getId(),data:data})}.bind(this)},connectAll:function(){this.buffer.start();for(var id in this.dataSourcesIdToDataSources)this.dataSourcesIdToDataSources[id].connect()}}),OSH.DataSender.DataSink=BaseClass.extend({initialize:function(name,properties,options){"http"==properties.protocol&&(this.connector=new OSH.DataConnector.AjaxConnector(this.buildUrl(properties)),this.connector.onError=this.onCatchError.bind(this),this.connector.onSuccess=this.onCatchSuccess.bind(this)),this.id="DataSource-"+OSH.Utils.randomUUID(),this.name=name,this.properties=properties},sendRequest:function(properties){this.connector.sendRequest(this.buildRequest(properties))},buildRequest:function(properties){return""},buildUrl:function(properties){var url="";return url+=properties.protocol+"://",url+=properties.endpointUrl},onCatchError:function(response){this.onError(response)},onCatchSuccess:function(response){this.onSuccess(response)},onError:function(response){},onSuccess:function(response){},getId:function(){return this.id},getName:function(){return this.name}}),OSH.DataSender.PtzTasking=OSH.DataSender.DataSink.extend({buildRequest:function(properties){var xmlSpsRequest="<sps:Submit ";return xmlSpsRequest+='service="'+this.properties.service+'" ',xmlSpsRequest+='version="'+this.properties.version+'" ',xmlSpsRequest+='xmlns:sps="http://www.opengis.net/sps/2.0" xmlns:swe="http://www.opengis.net/swe/2.0"> ',xmlSpsRequest+="<sps:procedure>"+this.properties.offeringID+"</sps:procedure>",xmlSpsRequest+="<sps:taskingParameters><sps:ParameterData>",xmlSpsRequest+='<sps:encoding><swe:TextEncoding blockSeparator=" "  collapseWhiteSpaces="true" decimalSeparator="." tokenSeparator=","/></sps:encoding>',xmlSpsRequest+="<sps:values>",0!=properties.pan&&(xmlSpsRequest+="rpan,"+properties.pan),0!=properties.tilt&&(xmlSpsRequest+=" rtilt,"+properties.tilt),
0!=properties.zoom&&(xmlSpsRequest+=" rzoom,"+properties.zoom),xmlSpsRequest+="</sps:values></sps:ParameterData></sps:taskingParameters></sps:Submit>",document.fire("osh:log",xmlSpsRequest),xmlSpsRequest}}),OSH.DataSender.UavMapTasking=OSH.DataSender.DataSink.extend({initialize:function(name,properties){this._super(name,properties),OSH.EventManager.observe(OSH.EventManager.EVENT.UAV_TAKEOFF,function(event){this.connector.sendRequest(this.buildTakeOffRequest())}.bind(this)),OSH.EventManager.observe(OSH.EventManager.EVENT.UAV_GOTO,function(event){this.connector.sendRequest(this.buildGotoRequest({lat:event.geoLat,lon:event.geoLon}))}.bind(this)),OSH.EventManager.observe(OSH.EventManager.EVENT.UAV_ORBIT,function(event){this.connector.sendRequest(this.buildOrbitRequest({lat:event.geoLat,lon:event.geoLon,radius:10}))}.bind(this)),OSH.EventManager.observe(OSH.EventManager.EVENT.UAV_LOOKAT,function(event){this.connector.sendRequest(this.buildLookAtRequest({lat:event.geoLat,lon:event.geoLon}))}.bind(this)),OSH.EventManager.observe(OSH.EventManager.EVENT.UAV_LAND,function(event){this.connector.sendRequest(this.buildLandRequest({lat:event.geoLat,lon:event.geoLon}))}.bind(this))},buildTakeOffRequest:function(props){return this.buildRequest("navCommands,TAKEOFF,10")},buildGotoRequest:function(props){return this.buildRequest("navCommands,GOTO_LLA,"+props.lat+","+props.lon+",0,0")},buildOrbitRequest:function(props){return this.buildRequest("navCommands,ORBIT,"+props.lat+","+props.lon+",0,"+props.radius)},buildLookAtRequest:function(props){return this.buildRequest("camCommands,MOUNT_TARGET,"+props.lat+","+props.lon+",0")},buildLandRequest:function(props){return this.buildRequest("navCommands,LAND,"+props.lat+","+props.lon)},buildRequest:function(cmdData){var xmlSpsRequest="<sps:Submit ";return xmlSpsRequest+='service="'+this.properties.service+'" ',xmlSpsRequest+='version="'+this.properties.version+'" ',xmlSpsRequest+='xmlns:sps="http://www.opengis.net/sps/2.0" xmlns:swe="http://www.opengis.net/swe/2.0"> ',xmlSpsRequest+="<sps:procedure>"+this.properties.offeringID+"</sps:procedure>",xmlSpsRequest+="<sps:taskingParameters><sps:ParameterData>",xmlSpsRequest+='<sps:encoding><swe:TextEncoding blockSeparator=" "  collapseWhiteSpaces="true" decimalSeparator="." tokenSeparator=","/></sps:encoding>',xmlSpsRequest+="<sps:values>"+cmdData+"</sps:values>",xmlSpsRequest+="</sps:ParameterData></sps:taskingParameters></sps:Submit>",document.fire("osh:log",xmlSpsRequest),xmlSpsRequest}}),OSH.DataSender.DataSenderController=BaseClass.extend({initialize:function(options){this.dataSources={}},addDataSource:function(dataSource){this.dataSources[dataSource.getId()]=dataSource},sendRequest:function(dataSourceId,properties,onSuccess,onError){dataSourceId in this.dataSources&&("undefined"!=typeof onSuccess&&null!=onSuccess&&(this.dataSources[dataSourceId].onSuccess=function(response){onSuccess(response)}),"undefined"!=typeof onError&&null!=onError&&(this.dataSources[dataSourceId].onError=function(response){onError(response)}),this.dataSources[dataSourceId].sendRequest(properties))}}),OSH.Sensor=BaseClass.extend({initialize:function(jsonix_offering){this.server=null,this.identifier=jsonix_offering.identifier,this.name=jsonix_offering.name[0].value,this.description=jsonix_offering.description,this.procedure=jsonix_offering.procedure;var timePeriod=null;if("undefined"!=typeof jsonix_offering.phenomenonTime&&(timePeriod=jsonix_offering.phenomenonTime.timePeriod),this.timeRangeStart=null!==timePeriod&&timePeriod.beginPosition.value.length>0?timePeriod.beginPosition.value[0]:"now",this.timeRangeEnd=null!==timePeriod&&timePeriod.endPosition.value.length>0?timePeriod.endPosition.value[0]:"now","now"==this.timeRangeEnd){var d=new Date;d.setUTCFullYear(2030),this.timeRangeEnd=d.toISOString()}if(this.observableProperties=[],this.outputs=[],this.featuresOfInterest=[],this.dataConnectors=[],"undefined"!=typeof jsonix_offering.observableProperty)for(var i=0;i<jsonix_offering.observableProperty.length;i++)this.observableProperties.push(jsonix_offering.observableProperty[i]);if("undefined"!=typeof jsonix_offering.relatedFeature)for(var j=0;j<jsonix_offering.relatedFeature.length;j++)this.featuresOfInterest.push(jsonix_offering.relatedFeature[j].featureRelationship.target.href)},describeSensor:function(){var req=this.server.url+"sensorhub/sos?service=SOS&version=2.0&request=DescribeSensor&procedure="+this.procedure,xhr=new XMLHttpRequest;xhr.onreadystatechange=function(){if(4==xhr.readyState&&200==xhr.status){console.log(this.name);var desc=OSH.Utils.jsonix_XML2JSON(xhr.responseText);this.onDescribeSensor(desc)}}.bind(this),xhr.open("GET",req,!0),xhr.send()},getResultTemplate:function(observabeProp){if(this.hasObservableProperty(observabeProp)){var req=this.server.url+"sensorhub/sos?service=SOS&version=2.0&request=GetResultTemplate&offering="+this.identifier+"&observedProperty="+observabeProp,xhr=new XMLHttpRequest;xhr.prop=observabeProp,xhr.onreadystatechange=function(){if(4==xhr.readyState&&200==xhr.status){var resultTemplate=OSH.Utils.jsonix_XML2JSON(xhr.responseText);if(resEncoding={},resEncoding.fields=[],resEncoding.type=resultTemplate.value.resultEncoding.abstractEncoding.name.localPart,"BinaryEncoding"==resEncoding.type){var binaryEncodingOpts=resultTemplate.value.resultEncoding.abstractEncoding.value.member;for(i=0;i<binaryEncodingOpts.length;i++){var ref=binaryEncodingOpts[i].component.ref;refToks=ref.split("/");var dataTypeToks=binaryEncodingOpts[i].component.dataType.split("/");resEncoding.fields.push({name:ref,type:dataTypeToks[dataTypeToks.length-1]})}}else if("TextEncoding"==resEncoding.type){var txtEncodingOpts=resultTemplate.value.resultEncoding.abstractEncoding.value;resEncoding.collapseWhiteSpaces=txtEncodingOpts.collapseWhiteSpaces,resEncoding.tokenSeparator=txtEncodingOpts.tokenSeparator,resEncoding.decimalSeparator=txtEncodingOpts.decimalSeparator}var resStruct={fields:[]};resStruct.findFieldByName=function(name){for(var f=0;f<this.fields.length;f++)if(this.fields[f].name==name)return this.fields[f]};for(var fields=resultTemplate.value.resultStructure.abstractDataComponent.value.field,i=0;i<fields.length;i++)this.buildDataFields(fields[i],resStruct);for(var j=0;j<resEncoding.fields.length;j++)this.setFieldEncoding(resStruct,resEncoding.fields[j]);this.onGetResultTemplate(observabeProp,resStruct,resEncoding)}}.bind(this),xhr.open("GET",req,!0),xhr.send()}},setFieldEncoding:function(fieldStruct,fieldEncoding){var path=fieldEncoding.name,pathToks=path.split("/");for(pathToks.shift(),currFieldStruct=fieldStruct;pathToks.length>0;){for(var i=0;i<currFieldStruct.fields.length;i++)if(currFieldStruct.fields[i].name==pathToks[0]){1==pathToks.length?currFieldStruct.fields[i].type=fieldEncoding.type:currFieldStruct=currFieldStruct.fields[i];break}pathToks.shift()}},buildDataFields:function(field,resultStruct){var dataComp=field.abstractDataComponent;if("undefined"!=typeof dataComp&&null!==dataComp){if("DataArray"==dataComp.name.localPart){var elemType=dataComp.value.elementType,elemCount=dataComp.value.elementCount,countVal=0;countVal="undefined"!=typeof elemCount.href?elemCount.href.split("#")[1]:elemCount.count.value;var field={name:field.name,val:[],count:countVal,fields:[]};resultStruct.fields.push(field),this.buildDataFields(elemType,field)}else if("Vector"==dataComp.name.localPart){var field={name:field.name,fields:[]};resultStruct.fields.push(field);for(var i=0;i<dataComp.value.coordinate.length;i++)this.buildDataFields(dataComp.value.coordinate[i],field)}else if(resultStruct.fields.push({name:field.name,val:null,fields:[]}),"undefined"!=typeof dataComp.value.id){resultStruct.id2FieldMap={};var id=dataComp.value.id;resultStruct.id2FieldMap[id]=field.name}}else resultStruct.fields.push({name:field.name,val:null,fields:[]})},getResultTemplateAll:function(){for(var i=0;i<this.observableProperties.length;i++)this.getResultTemplate(this.observableProperties[i])},createDataConnector:function(observableProp,featureOfInterest,spatialFilter,startTime,endTime,playbackSpeed){if(startTime=this.timeRangeStart,endTime=this.timeRangeEnd,playbackSpeed=1,null===observableProp||"undefined"==typeof observableProp||!this.hasObservableProperty(observableProp))return console.log("Could not create data connector! Property: "+observableProp+" does not exist."),null;var url=this.server.getUrl();if(url=url.replace("http://","ws://"),url+="sensorhub/sos?service=SOS&version=2.0&request=GetResult&offering="+this.identifier,url+="&observedProperty="+observableProp,!this.isValidTime(startTime)||!this.isValidTime(endTime))return console.log("Could not create data connector! Invalid time range"),null;url+="&temporalFilter=phenomenonTime,"+startTime+"/"+endTime,playbackSpeed>0&&(url+="&replaySpeed="+playbackSpeed),null!==featureOfInterest&&hasFeatureOfInterest(featureOfInterest)?url+="&featureOfInterest="+featureOfInterest:console.log("Warning! Feature Of Interest: "+featureOfInterest+" does not exist. Ignoring and returning all data");var conn=new OSH.DataConnector.WebSocketDataConnector(url);return this.dataConnectors.push(conn),conn},createDataConnectorAll:function(featureOfInterest,spatialFilter,startTime,endTime,playbackSpeed){"undefined"==typeof startTime&&(startTime=this.timeRangeStart),"undefined"==typeof endTime&&(startTime=this.timeRangeEnd),"undefined"==typeof playbackSpeed&&(playbackSpeed=1);for(var conns=[],i=0;i<this.observableProperties.length;i++)conns.push(this.createDataConnector(this.observableProperties[i],featureOfInterest,spatialFilter,startTime,endTime,playbackSpeed));return conns},hasObservableProperty:function(prop){for(var i=0;i<this.observableProperties.length;i++)if(this.observableProperties[i]==prop)return!0;return!1},hasFeatureOfInterest:function(foi){for(var i=0;i<this.featuresOfInterest.length;i++)if(this.featuresOfInterest[i]==foi)return!0;return!1},isValidTime:function(timeStr){var d;d="now"==timeStr?new Date:new Date(timeStr);var start;start="now"==this.timeRangeStart?new Date:new Date(this.timeRangeStart);var end;return end="now"==this.timeRangeEnd?new Date:new Date(this.timeRangeEnd),d>=start&&d<=end},onDescribeSensor:function(data){},onGetResultTemplate:function(obsProperty,resultStruct,resultEncoding){}}),OSH.Server=BaseClass.extend({initialize:function(url){this.url=url,this.id="Server-"+OSH.Utils.randomUUID(),this.capabilities=null,this.sensors=[]},getId:function(){return this.id},getUrl:function(){return this.url},getCapabilities:function(successCallback,errorCallback){var req=this.url+"sensorhub/sos?service=SOS&version=2.0&request=GetCapabilities",xhr=new XMLHttpRequest;xhr.onreadystatechange=function(){if(4==xhr.readyState&&200==xhr.status){this.capabilities=OSH.Utils.jsonix_XML2JSON(xhr.responseText);for(var i=0;i<this.capabilities.value.contents.contents.offering.length;i++){var sensor=new OSH.Sensor(this.capabilities.value.contents.contents.offering[i].abstractOffering.value);sensor.server=this,this.sensors.push(sensor)}var s=successCallback.bind(this);s(xhr.responseText)}else errorCallback(xhr.responseText)}.bind(this),xhr.open("GET",req,!0),xhr.send()},getSensorById:function(id){for(var i=0;i<this.sensors.length;i++)if(this.sensors[i].identifier==id)return this.sensors[i];return null}}),OSH.Log=BaseClass.extend({initialize:function(){this.logDiv=document.createElement("TEXTAREA"),this.logDiv.setAttribute("class","osh-log popup-content"),this.logDiv.setAttribute("wrap","off"),this.first=!0,document.observe("dom:loaded",function(){new OSH.UI.DialogView({title:"Logging console"})}.bind(this)),document.observe("osh:log",function(event){this.first?(this.logDiv.value="[osh-log]> "+event.memo+"\n",this.first=!1):this.logDiv.value+="[osh-log]> "+event.memo+"\n"}.bind(this))}}),OSH.UI.View=BaseClass.extend({initialize:function(divId,viewItems,options){this.stylers=[],this.contextMenus=[],this.viewItems=[],this.names={},this.stylerToObj={},this.stylerIdToStyler={},this.lastRec={},this.selectedDataSources=[],this.dataSources=[],this.id="view-"+OSH.Utils.randomUUID(),this.dataSourceId=-1,"undefined"!=typeof options&&"undefined"!=typeof options.dataSourceId&&(this.dataSourceId=options.dataSourceId),"undefined"!=typeof options&&"undefined"!=typeof options.entityId&&(this.entityId=options.entityId),this.css="",this.cssSelected="","undefined"!=typeof options&&"undefined"!=typeof options.css&&(this.css=options.css),"undefined"!=typeof options&&"undefined"!=typeof options.cssSelected&&(this.cssSelected=options.cssSelected),this.init(divId,viewItems,options)},init:function(divId,viewItems,options){this.elementDiv=document.createElement("div"),this.elementDiv.setAttribute("id",this.id),this.elementDiv.setAttribute("class",this.css),this.divId=this.id;var div=document.getElementById(divId);if(null==divId||"undefined"==div||null==div||""==divId?(document.body.appendChild(this.elementDiv),this.hide(),this.container=document.body):(div.appendChild(this.elementDiv),this.container=div),this.beforeAddingItems(options),"undefined"!=typeof viewItems)for(var i=0;i<viewItems.length;i++)this.addViewItem(viewItems[i]);"undefined"!=typeof options&&"undefined"!=typeof options.show&&(document.getElementById(this.divId).style.display=options.show?"block":"none"),this.handleEvents(),"undefined"!=typeof options&&"undefined"!=typeof options.dataSourceId&&OSH.EventManager.observe(OSH.EventManager.EVENT.DATA+"-"+options.dataSourceId,function(event){event.reset?this.reset():this.setData(options.dataSourceId,event.data)}.bind(this));var self=this,observer=new MutationObserver(function(mutations){mutations.forEach(function(mutation){"style"===mutation.attributeName&&self.onResize()})});observer.observe(this.elementDiv,{attributes:!0})},hide:function(){this.elementDiv.style.display="none"},onResize:function(){},attachTo:function(divId){"undefined"!=typeof this.elementDiv.parentNode&&this.elementDiv.parentNode.removeChild(this.elementDiv),document.getElementById(divId).appendChild(this.elementDiv),"none"==this.elementDiv.style.display&&(this.elementDiv.style.display="block")},beforeAddingItems:function(options){},getId:function(){return this.id},getDivId:function(){return this.divId},setData:function(dataSourceId,data){},show:function(properties){},shows:function(properties){},addViewItem:function(viewItem){if(this.viewItems.push(viewItem),viewItem.hasOwnProperty("styler")){var styler=viewItem.styler;this.stylers.push(styler),viewItem.hasOwnProperty("name")&&(this.names[styler.getId()]=viewItem.name),styler.init(this),styler.viewItem=viewItem,this.stylerIdToStyler[styler.id]=styler}viewItem.hasOwnProperty("contextmenu")&&this.contextMenus.push(viewItem.contextmenu);for(var ds=styler.getDataSourcesIds(),i=0;i<ds.length;i++){var dataSourceId=ds[i],self=this;!function(frozenDataSourceId){OSH.EventManager.observe(OSH.EventManager.EVENT.DATA+"-"+frozenDataSourceId,function(event){if(!event.reset){var selected=!1;selected="undefined"!=typeof self.selectedEntity?viewItem.entityId==self.selectedEntity:self.selectedDataSources.indexOf(frozenDataSourceId)>-1,styler.setData(frozenDataSourceId,event.data,self,{selected:selected}),self.lastRec[frozenDataSourceId]=event.data}}),OSH.EventManager.observe(OSH.EventManager.EVENT.SELECT_VIEW,function(event){var selected=!1;selected="undefined"!=typeof event.entityId?viewItem.entityId==event.entityId:event.dataSourcesIds.indexOf(frozenDataSourceId)>-1,frozenDataSourceId in self.lastRec&&styler.setData(frozenDataSourceId,self.lastRec[frozenDataSourceId],self,{selected:selected})})}(dataSourceId)}},handleEvents:function(){OSH.EventManager.observe(OSH.EventManager.EVENT.SELECT_VIEW,function(event){this.selectDataView(event.dataSourcesIds,event.entityId)}.bind(this)),OSH.EventManager.observe(OSH.EventManager.EVENT.SHOW_VIEW,function(event){this.show(event)}.bind(this)),OSH.EventManager.observe(OSH.EventManager.EVENT.ADD_VIEW_ITEM,function(event){"undefined"!=typeof event.viewId&&event.viewId==this.id&&this.addViewItem(event.viewItem)}.bind(this)),OSH.EventManager.observe(OSH.EventManager.EVENT.RESIZE+"-"+this.divId,function(event){this.onResize()}.bind(this))},selectDataView:function(dataSourcesIds,entityId){if("undefined"!=typeof this.dataSources){this.selectedDataSources=dataSourcesIds,this.selectedEntity=entityId;for(var j=0;j<this.dataSources.length;j++)this.setData(this.dataSources[j],this.lastRec[this.dataSources[j]])}},getDataSourcesId:function(){var res=[];this.dataSourceId!=-1&&res.push(this.dataSourceId);for(var i=0;i<this.viewItems.length;i++){var viewItem=this.viewItems[i];if(viewItem.hasOwnProperty("styler")){var styler=viewItem.styler;res=res.concat(styler.getDataSourcesIds())}}return res},reset:function(){}}),OSH.UI.ContextMenu=BaseClass.extend({initialize:function(properties){"undefined"!=typeof properties&&"undefined"!=typeof properties.id?this.id=properties.id:this.id="contextMenu-"+OSH.Utils.randomUUID(),this.handleEvents()},show:function(){},hide:function(){},handleEvents:function(){OSH.EventManager.observe(OSH.EventManager.EVENT.CONTEXT_MENU+"-"+this.id,function(event){"show"==event.action?this.show(event):"hide"==event.action&&this.hide()}.bind(this))}}),OSH.UI.ContextMenu.CssMenu=OSH.UI.ContextMenu.extend({initialize:function(properties,type){if(this._super(properties),this.items=[],"undefined"!=typeof type?this.type=type:this.type="","undefined"!=typeof properties&&"undefined"!=typeof properties.items)for(var i=0;i<properties.items.length;i++){var elId=OSH.Utils.randomUUID(),htmlVar='<a  id="'+elId+'" ';"undefined"!=typeof properties.items[i].css&&(htmlVar+='class="'+properties.items[i].css+'" ');var name="";"undefined"!=typeof properties.items[i].name&&(name=properties.items[i].name),htmlVar+='title="'+name+'"',htmlVar+='><span id ="'+elId+'"class="'+this.type+'-menu-label">'+name+"</span></a>";var action="";"undefined"!=typeof properties.items[i].action&&(action=properties.items[i].action);var viewId="";"undefined"!=typeof properties.items[i].viewId&&(viewId=properties.items[i].viewId),this.items.push({html:htmlVar,id:elId,action:action,viewId:viewId})}},show:function(properties){this.removeElement();var closeId=OSH.Utils.randomUUID(),htmlVar=(OSH.Utils.randomUUID(),"");htmlVar+='<div class="'+this.type+'-menu">',htmlVar+='  <div class="'+this.type+'-menu-circle">';for(var i=0;i<this.items.length;i++)htmlVar+=this.items[i].html;htmlVar+="  </div>",htmlVar+='  <a id="'+closeId+'"class="'+this.type+'-menu-button fa fa-times fa-2x"></a>',htmlVar+="</div>",this.rootTag=document.createElement("div"),this.rootTag.setAttribute("class",""+this.type+"-menu-container"),this.rootTag.innerHTML=htmlVar,document.body.appendChild(this.rootTag);for(var items=document.querySelectorAll("."+this.type+"-menu-circle a"),i=0,l=items.length;i<l;i++)items[i].style.left=(50-35*Math.cos(-.5*Math.PI-2*(1/l)*i*Math.PI)).toFixed(4)+"%",items[i].style.top=(50+35*Math.sin(-.5*Math.PI-2*(1/l)*i*Math.PI)).toFixed(4)+"%";document.getElementById(closeId).onclick=this.hide.bind(this);var offsetX=0,offsetY=0;properties.offsetX&&(offsetX=properties.offsetX),properties.offsetY&&(offsetY=properties.offsetY),document.querySelector("."+this.type+"-menu-circle").classList.toggle("open"),"undefined"!=typeof properties.x&&(this.rootTag.style.left=properties.x+offsetX),"undefined"!=typeof properties.y&&(this.rootTag.style.top=properties.y+offsetY),this.bindEvents={};for(var i=0;i<this.items.length;i++){var item=this.items[i];this.bindEvents[item.id]=item.viewId,document.getElementById(item.id).onclick=function(event){OSH.EventManager.fire(OSH.EventManager.EVENT.SHOW_VIEW,{viewId:this.bindEvents[event.target.id]})}.bind(this)}this.rootTag.onmousedown=function(event){event.preventDefault(),event.stopPropagation()}},hide:function($super){document.querySelector("."+this.type+"-menu-circle").classList.toggle("open"),this.removeElement()},removeElement:function(){"undefined"!=typeof this.rootTag&&null!=this.rootTag&&"undefined"!=typeof this.rootTag.parentNode&&(this.rootTag.parentNode.removeChild(this.rootTag),this.rootTag=null)},getTransform:function(el){var transform=el.style.transform;if(!transform||0===transform.length)return"";var regExp=/^\s*((\w+)\s*\(([^)]+)\))/,matches=regExp.exec(transform);return matches[1]}}),OSH.UI.ContextMenu.CircularMenu=OSH.UI.ContextMenu.CssMenu.extend({initialize:function(properties){this._super(properties,"circular")}}),OSH.UI.ContextMenu.StackMenu=OSH.UI.ContextMenu.CssMenu.extend({initialize:function(properties){this._super(properties,"stack")},show:function(properties){this.removeElement();var htmlVar="";htmlVar+='  <div class="'+this.type+'-menu-circle">';for(var i=0;i<this.items.length;i++)htmlVar+=this.items[i].html;htmlVar+="  </div>",this.rootTag=document.createElement("div"),this.rootTag.setAttribute("class",""+this.type+"-menu-container"),this.rootTag.innerHTML=htmlVar,"undefined"!=typeof properties.div?properties.div.appendChild(this.rootTag):document.body.appendChild(this.rootTag);var offsetX=0,offsetY=0;properties.offsetX&&(offsetX=properties.offsetX),properties.offsetY&&(offsetY=properties.offsetY),"undefined"!=typeof properties.x&&(this.rootTag.style.left=properties.x+offsetX),"undefined"!=typeof properties.y&&(this.rootTag.style.top=properties.y+offsetY),document.querySelector("."+this.type+"-menu-circle").classList.toggle("open"),this.bindEvents={};for(var i=0;i<this.items.length;i++){var item=this.items[i];this.bindEvents[item.id]=item.viewId,document.getElementById(item.id).onclick=function(event){OSH.EventManager.fire(OSH.EventManager.EVENT.SHOW_VIEW,{viewId:this.bindEvents[event.target.id]})}.bind(this)}this.rootTag.onmousedown=function(event){event.preventDefault(),event.stopPropagation()}}}),OSH.UI.Styler=BaseClass.extend({initialize:function(jsonProperties){this.properties=jsonProperties,this.id="styler-"+OSH.Utils.randomUUID(),this.dataSourceToStylerMap={},this.initEvents()},initEvents:function(){OSH.EventManager.observe(OSH.EventManager.EVENT.DATASOURCE_UPDATE_TIME,function(event){this.clear()}.bind(this))},clear:function(){},setData:function(dataSourceId,data,view){},getId:function(){return this.id},select:function(dataSourceIds){},addFn:function(dataSourceIds,fn){for(var i=0;i<dataSourceIds.length;i++){var dataSourceId=dataSourceIds[i];"undefined"==typeof this.dataSourceToStylerMap[dataSourceId]&&(this.dataSourceToStylerMap[dataSourceId]=[]),this.dataSourceToStylerMap[dataSourceId].push(fn)}},setData:function(dataSourceId,rec,view,options){if(dataSourceId in this.dataSourceToStylerMap){for(var fnArr=this.dataSourceToStylerMap[dataSourceId],i=0;i<fnArr.length;i++)fnArr[i](rec.data,rec.timeStamp,options);return!0}return!1},getDataSourcesIds:function(){var res=[];for(var i in this.dataSourceToStylerMap)res.push(i);return res},init:function(){}}),OSH.UI.Styler.ImageDraping=OSH.UI.Styler.extend({initialize:function(properties){if(this._super(properties),this.properties=properties,this.platformLocation=null,this.platformOrientation=null,this.gimbalOrientation=null,this.cameraModel=null,this.imageSrc=null,this.snapshotFunc=null,this.options={},"undefined"!=typeof properties.platformLocation&&(this.platformLocation=properties.platformLocation),"undefined"!=typeof properties.platformOrientation&&(this.platformOrientation=properties.platformOrientation),"undefined"!=typeof properties.gimbalOrientation&&(this.gimbalOrientation=properties.gimbalOrientation),"undefined"!=typeof properties.cameraModel&&(this.cameraModel=properties.cameraModel),"undefined"!=typeof properties.imageSrc&&(this.imageSrc=properties.imageSrc),"undefined"!=typeof properties.platformLocationFunc){var fn=function(rec,timeStamp,options){this.platformLocation=properties.platformLocationFunc.handler(rec,timeStamp,options)}.bind(this);this.addFn(properties.platformLocationFunc.dataSourceIds,fn)}if("undefined"!=typeof properties.platformOrientationFunc){var fn=function(rec,timeStamp,options){this.platformOrientation=properties.platformOrientationFunc.handler(rec,timeStamp,options)}.bind(this);this.addFn(properties.platformOrientationFunc.dataSourceIds,fn)}if("undefined"!=typeof properties.gimbalOrientationFunc){var fn=function(rec,timeStamp,options){this.gimbalOrientation=properties.gimbalOrientationFunc.handler(rec,timeStamp,options)}.bind(this);this.addFn(properties.gimbalOrientationFunc.dataSourceIds,fn)}if("undefined"!=typeof properties.cameraModelFunc){var fn=function(rec,timeStamp,options){this.cameraModel=properties.cameraModelFunc.handler(rec,timeStamp,options)}.bind(this);this.addFn(properties.cameraModelFunc.dataSourceIds,fn)}"undefined"!=typeof properties.snapshotFunc&&(this.snapshotFunc=properties.snapshotFunc)},init:function(view){this._super(view)},setData:function(dataSourceId,rec,view,options){if(this._super(dataSourceId,rec,view,options)){var enabled=!0;null!=this.snapshotFunc&&(enabled=this.snapshotFunc()),"undefined"!=typeof view&&enabled&&null!=this.platformLocation&&null!=this.platformOrientation&&null!=this.gimbalOrientation&&null!=this.cameraModel&&null!=this.imageSrc&&view.updateDrapedImage(this,rec.timeStamp,options)}}}),OSH.UI.Styler.Curve=OSH.UI.Styler.extend({initialize:function(properties){if(this._super(properties),this.xLabel="",this.yLabel="",this.color="#000000",this.stroke=1,this.x=0,this.y=[],"undefined"!=typeof properties.stroke&&(this.stroke=properties.stroke),"undefined"!=typeof properties.color&&(this.color=properties.color),"undefined"!=typeof properties.x&&(this.x=properties.x),"undefined"!=typeof properties.y&&(this.y=properties.y),"undefined"!=typeof properties.strokeFunc){var fn=function(rec,timeStamp,options){this.stroke=properties.strokeFunc.handler(rec,timeStamp,options)}.bind(this);this.addFn(properties.strokeFunc.dataSourceIds,fn)}if("undefined"!=typeof properties.colorFunc){var fn=function(rec,timeStamp,options){this.color=properties.colorFunc.handler(rec,timeStamp,options)}.bind(this);this.addFn(properties.colorFunc.dataSourceIds,fn)}if("undefined"!=typeof properties.valuesFunc){var fn=function(rec,timeStamp,options){var values=properties.valuesFunc.handler(rec,timeStamp,options);this.x=values.x,this.y=values.y}.bind(this);this.addFn(properties.valuesFunc.dataSourceIds,fn)}},setData:function(dataSourceId,rec,view,options){this._super(dataSourceId,rec,view,options)&&"undefined"!=typeof view&&view.updateCurve(this,rec.timeStamp,options)}}),OSH.UI.Styler.Polyline=OSH.UI.Styler.extend({initialize:function(properties){if(this._super(properties),this.properties=properties,this.locations=[],this.color="red",this.weight=1,this.opacity=1,this.smoothFactor=1,this.maxPoints=10,"undefined"!=typeof properties.color&&(this.color=properties.color),"undefined"!=typeof properties.weight&&(this.weight=properties.weight),"undefined"!=typeof properties.opacity&&(this.opacity=properties.opacity),"undefined"!=typeof properties.smoothFactor&&(this.smoothFactor=properties.smoothFactor),"undefined"!=typeof properties.maxPoints&&(this.maxPoints=properties.maxPoints),"undefined"!=typeof properties.locationFunc){var fn=function(rec){var loc=properties.locationFunc.handler(rec);this.locations.push(loc),this.locations.length>this.maxPoints&&this.locations.shift()}.bind(this);this.addFn(properties.locationFunc.dataSourceIds,fn)}if("undefined"!=typeof properties.colorFunc){var fn=function(rec){this.color=properties.colorFunc.handler(rec)}.bind(this);this.addFn(properties.colorFunc.dataSourceIds,fn)}if("undefined"!=typeof properties.weightFunc){var fn=function(rec){this.weight=properties.weightFunc.handler(rec)}.bind(this);this.addFn(properties.weightFunc.dataSourceIds,fn)}if("undefined"!=typeof properties.opacityFunc){var fn=function(rec){this.opacity=properties.opacityFunc.handler(rec)}.bind(this);this.addFn(properties.opacityFunc.dataSourceIds,fn)}if("undefined"!=typeof properties.smoothFactorFunc){var fn=function(rec){this.smoothFactor=properties.smoothFactorFunc.handler(rec)}.bind(this);this.addFn(properties.smoothFactorFunc.dataSourceIds,fn)}},setData:function(dataSourceId,rec,view,options){this._super(dataSourceId,rec,view,options)&&"undefined"!=typeof view&&"function"==typeof view.updatePolyline&&view.updatePolyline(this)},clear:function($super){this.locations=[]}}),OSH.UI.Styler.PointMarker=OSH.UI.Styler.extend({initialize:function(properties){if(this._super(properties),this.properties=properties,this.location=null,this.orientation={heading:0},this.icon=null,this.iconAnchor=[16,16],this.label=null,this.color="#000000",this.options={},"undefined"!=typeof properties.location&&(this.location=properties.location),"undefined"!=typeof properties.orientation&&(this.orientation=properties.orientation),"undefined"!=typeof properties.icon&&(this.icon=properties.icon),"undefined"!=typeof properties.iconAnchor&&(this.iconAnchor=properties.iconAnchor),"undefined"!=typeof properties.label&&(this.label=properties.label),"undefined"!=typeof properties.color&&(this.color=properties.color),"undefined"!=typeof properties.locationFunc){var fn=function(rec,timeStamp,options){this.location=properties.locationFunc.handler(rec,timeStamp,options)}.bind(this);this.addFn(properties.locationFunc.dataSourceIds,fn)}if("undefined"!=typeof properties.orientationFunc){var fn=function(rec,timeStamp,options){this.orientation=properties.orientationFunc.handler(rec,timeStamp,options)}.bind(this);this.addFn(properties.orientationFunc.dataSourceIds,fn)}if("undefined"!=typeof properties.iconFunc){var fn=function(rec,timeStamp,options){this.icon=properties.iconFunc.handler(rec,timeStamp,options)}.bind(this);this.addFn(properties.iconFunc.dataSourceIds,fn)}if("undefined"!=typeof properties.labelFunc){var fn=function(rec,timeStamp,options){this.label=properties.labelFunc.handler(rec,timeStamp,options)}.bind(this);this.addFn(properties.labelFunc.dataSourceIds,fn)}if("undefined"!=typeof properties.colorFunc){var fn=function(rec,timeStamp,options){this.color=properties.colorFunc.handler(rec,timeStamp,options)}.bind(this);this.addFn(properties.colorFunc.dataSourceIds,fn)}},init:function(view){this._super(view),"undefined"!=typeof view&&null!=this.location&&view.updateMarker(this,0,{})},setData:function(dataSourceId,rec,view,options){this._super(dataSourceId,rec,view,options)&&"undefined"!=typeof view&&null!=this.location&&view.updateMarker(this,rec.timeStamp,options)},clear:function($super){}}),OSH.UI.DiscoveryView=OSH.UI.View.extend({initialize:function(divId,properties){this._super(divId,[],properties),this.swapId="","undefined"!=typeof properties&&("undefined"!=typeof properties.dataReceiverController?this.dataReceiverController=properties.dataReceiverController:(this.dataReceiverController=new OSH.DataReceiver.DataReceiverController({replayFactor:1}),this.dataReceiverController.connectAll()),"undefined"!=typeof properties.swapId&&(this.swapId=properties.swapId)),this.formTagId="form-"+OSH.Utils.randomUUID(),this.serviceSelectTagId="service-"+OSH.Utils.randomUUID(),this.offeringSelectTagId="offering-"+OSH.Utils.randomUUID(),this.observablePropertyTagId="obsProperty-"+OSH.Utils.randomUUID(),this.startTimeTagId="startTime-"+OSH.Utils.randomUUID(),this.endTimeTagId="endTime-"+OSH.Utils.randomUUID(),this.typeSelectTagId="type-"+OSH.Utils.randomUUID(),this.formButtonId="submit-"+OSH.Utils.randomUUID(),this.syncMasterTimeId="syncMasterTime-"+OSH.Utils.randomUUID(),this.entitiesSelectTagId="entities-"+OSH.Utils.randomUUID(),this.viewSelectTagId="dialogSelect-"+OSH.Utils.randomUUID();var discoveryForm=document.createElement("form");discoveryForm.setAttribute("action","#"),discoveryForm.setAttribute("id",this.formTagId),discoveryForm.setAttribute("class","discovery-form"),document.getElementById(this.divId).appendChild(discoveryForm);var strVar="";strVar+="<ul>",strVar+="            <li>",strVar+="                <h2>Discovery</h2>",strVar+='                <span class="required_notification">* Denotes Required Field</span>',strVar+="            </li>",strVar+="            <li>",strVar+="                <label>Service:</label>",strVar+='                <div class="select-style">',
strVar+='                     <select id="'+this.serviceSelectTagId+'" required pattern="^(?!Select a service$).*">',strVar+='                         <option value="" disabled selected>Select a service</option>',strVar+="                     </select>",strVar+="                </div>",strVar+="            </li>",strVar+="            <li>",strVar+="                <label>Offering:</label>",strVar+='                <div class="select-style">',strVar+='                    <select id="'+this.offeringSelectTagId+'" required>',strVar+='                        <option value="" disabled selected>Select an offering</option>',strVar+="                    </select>",strVar+="                </div>",strVar+="            </li>",strVar+="            <li>",strVar+="                <label>Observable Property:</label>",strVar+='                <div class="select-style">',strVar+='                     <select id="'+this.observablePropertyTagId+'" required>',strVar+='                         <option value="" disabled selected>Select a property</option>',strVar+="                     </select>",strVar+="                </div>",strVar+="            </li>",strVar+="            <li>",strVar+='                <label for="startTime">Start time:</label>',strVar+='                <input id="'+this.startTimeTagId+'" type="text" name="startTime" class="input-text" placeholder="YYYY-MM-DDTHH:mm:ssZ" required/>',strVar+='                <span class="form_hint">YYYY-MM-DDTHH:mm:ssZ</span>',strVar+="            </li>",strVar+="            <li>",strVar+='                <label for="endTime">End time:</label>',strVar+='                <input id="'+this.endTimeTagId+'" type="text" name="endTime" class="input-text" placeholder="YYYY-MM-DDTHH:mm:ssZ"  required/>',strVar+='                <span class="form_hint">YYYY-MM-DDTHH:mm:ssZ</span>',strVar+="            </li>",strVar+="            <li>",strVar+='                <label for="syncMasterTime">Sync master time:</label>',strVar+='                <input id="'+this.syncMasterTimeId+'"  class="input-checkbox" type="checkbox" name=syncMasterTime" />',strVar+="            </li>",strVar+="            <li>",strVar+="                <label>Type:</label>",strVar+='                <div class="select-style">',strVar+='                    <select id="'+this.typeSelectTagId+'" required>',strVar+='                        <option value="" disabled selected>Select a type</option>',strVar+="                    </select>",strVar+="                </div>",strVar+="            </li>",strVar+="            <li>",strVar+="                <label>Entities:</label>",strVar+='                <div class="select-style">',strVar+='                    <select id="'+this.entitiesSelectTagId+'">',strVar+='                        <option value="" selected>None</option>',strVar+="                    </select>",strVar+="                </div>",strVar+="            </li>",strVar+="            <li>",strVar+="                <label>View:</label>",strVar+='                <div class="select-style">',strVar+='                    <select id="'+this.viewSelectTagId+'" required>',strVar+='                        <option value="" disabled selected>Select a view</option>',strVar+="                    </select>",strVar+="                </div>",strVar+="            </li>",strVar+="            <li>",strVar+='                <button id="'+this.formButtonId+'" class="submit" type="submit">Add</button>',strVar+="            </li>",strVar+="        </ul>",discoveryForm.innerHTML=strVar,"undefined"!=typeof properties&&("undefined"!=typeof properties.services&&this.addValuesToSelect(this.serviceSelectTagId,properties.services),"undefined"!=typeof properties.entities&&this.addObjectsToSelect(this.entitiesSelectTagId,properties.entities),"undefined"!=typeof properties.views?this.views=properties.views:this.views=[]);for(var type in OSH.UI.DiscoveryView.Type)this.addValueToSelect(this.typeSelectTagId,OSH.UI.DiscoveryView.Type[type]);OSH.EventManager.observeDiv(this.serviceSelectTagId,"change",this.onSelectedService.bind(this)),OSH.EventManager.observeDiv(this.offeringSelectTagId,"change",this.onSelectedOffering.bind(this)),OSH.EventManager.observeDiv(this.typeSelectTagId,"change",this.onSelectedType.bind(this)),OSH.EventManager.observeDiv(this.formTagId,"submit",this.onFormSubmit.bind(this))},onSelectedService:function(event){var serverTag=document.getElementById(this.serviceSelectTagId),option=serverTag.options[serverTag.selectedIndex],oshServer=new OSH.Server(option.value);this.removeAllFromSelect(this.offeringSelectTagId);var onSuccessGetCapabilities=function(event){this.sensors=oshServer.sensors;for(var i=(document.getElementById(this.startTimeTagId),document.getElementById(this.endTimeTagId),0);i<this.sensors.length;i++)this.addValueToSelect(this.offeringSelectTagId,this.sensors[i].name,this.sensors[i],this.sensors[i])}.bind(this),onErrorGetCapabilities=function(event){};oshServer.getCapabilities(onSuccessGetCapabilities,onErrorGetCapabilities)},onSelectedOffering:function(event){var e=document.getElementById(this.offeringSelectTagId),option=e.options[e.selectedIndex];this.removeAllFromSelect(this.observablePropertyTagId);for(var startTimeInputTag=document.getElementById(this.startTimeTagId),endTimeInputTag=document.getElementById(this.endTimeTagId),i=0;i<option.parent.observableProperties.length;i++)this.addValueToSelect(this.observablePropertyTagId,option.parent.observableProperties[i]),startTimeInputTag.value=option.parent.timeRangeStart,endTimeInputTag.value=option.parent.timeRangeEnd},onSelectedType:function(event){var typeTag=document.getElementById(this.typeSelectTagId),tagValue=typeTag.value;this.removeAllFromSelect(this.viewSelectTagId);for(var i=0;i<this.views.length;i++){var currentView=this.views[i];"undefined"!=typeof currentView.type&&currentView.type==tagValue&&this.addValueToSelect(this.viewSelectTagId,currentView.name,void 0,currentView)}},onFormSubmit:function(event){event.preventDefault();var serviceTag=document.getElementById(this.serviceSelectTagId),serviceTagSelectedOption=serviceTag.options[serviceTag.selectedIndex],offeringTag=document.getElementById(this.offeringSelectTagId),offeringTagSelectedOption=offeringTag.options[offeringTag.selectedIndex],observablePropertyTag=document.getElementById(this.observablePropertyTagId),observablePropertyTagSelectedOption=observablePropertyTag.options[observablePropertyTag.selectedIndex],startTimeInputTag=document.getElementById(this.startTimeTagId),endTimeInputTag=document.getElementById(this.endTimeTagId),syncMasterTimeTag=document.getElementById(this.syncMasterTimeId),viewTag=(document.getElementById(this.typeSelectTagId),document.getElementById(this.viewSelectTagId)),viewTagOption=viewTag.options[viewTag.selectedIndex],entityTag=document.getElementById(this.entitiesSelectTagId),entityTagTagOption=entityTag.options[entityTag.selectedIndex],name=offeringTagSelectedOption.parent.name,endPointUrl=serviceTagSelectedOption.value+"sensorhub/sos",offeringID=offeringTagSelectedOption.parent.identifier,obsProp=observablePropertyTagSelectedOption.value,startTime=startTimeInputTag.value,endTime=endTimeInputTag.value,entityId=(viewTagOption.object.viewId,void 0);"undefined"!=typeof entityTagTagOption.object&&(entityId=entityTagTagOption.object.id),endPointUrl=endPointUrl.replace("http://","");var syncMasterTime=syncMasterTimeTag.checked;switch(viewTagOption.object.type){case OSH.UI.DiscoveryView.Type.DIALOG_VIDEO_MJPEG:this.createMJPEGVideoDialog(name,endPointUrl,offeringID,obsProp,startTime,endTime,syncMasterTime,entityId);break;case OSH.UI.DiscoveryView.Type.DIALOG_VIDEO_H264:this.createH264VideoDialog(name,endPointUrl,offeringID,obsProp,startTime,endTime,syncMasterTime,entityId);break;case OSH.UI.DiscoveryView.Type.MARKER_GPS:this.createGPSMarker(name,endPointUrl,offeringID,obsProp,startTime,endTime,syncMasterTime,viewTagOption.object.viewId,entityId);break;case OSH.UI.DiscoveryView.Type.DIALOG_CHART:this.createChartDialog(name,endPointUrl,offeringID,obsProp,startTime,endTime,syncMasterTime,entityId)}return!1},addObjectsToSelect:function(tagId,objectsArr){for(var selectTag=document.getElementById(tagId),i=0;i<objectsArr.length;i++){var object=objectsArr[i],option=document.createElement("option");option.text=object.name,option.value=object.name,option.object=object,selectTag.add(option)}},addValuesToSelect:function(tagId,valuesArr){for(var selectTag=document.getElementById(tagId),i=0;i<valuesArr.length;i++){var value=valuesArr[i],option=document.createElement("option");option.text=value,option.value=value,selectTag.add(option)}},addValueToSelect:function(tagId,value,parent,object){var selectTag=document.getElementById(tagId),option=document.createElement("option");option.text=value,option.value=value,"undefined"!=typeof parent&&(option.parent=parent),"undefined"!=typeof object&&(option.object=object),selectTag.add(option)},removeAllFromSelect:function(tagId){var i,selectTag=document.getElementById(tagId);for(i=selectTag.options.length-1;i>0;i--)selectTag.remove(i)},createGPSMarker:function(name,endPointUrl,offeringID,obsProp,startTime,endTime,syncMasterTime,viewId,entityId){var gpsDataSource=new OSH.DataReceiver.LatLonAlt(name,{protocol:"ws",service:"SOS",endpointUrl:endPointUrl,offeringID:offeringID,observedProperty:obsProp,startTime:startTime,endTime:endTime,replaySpeed:1,syncMasterTime:syncMasterTime,bufferingTime:1e3,timeShift:-16e3}),pointMarker=new OSH.UI.Styler.PointMarker({locationFunc:{dataSourceIds:[gpsDataSource.id],handler:function(rec){return{x:rec.lon,y:rec.lat,z:rec.alt}}},icon:"images/cameralook.png",iconFunc:{dataSourceIds:[gpsDataSource.getId()],handler:function(rec,timeStamp,options){return options.selected?"images/cameralook-selected.png":"images/cameralook.png"}}});this.dataReceiverController.addDataSource(gpsDataSource);var viewItem={styler:pointMarker,name:name};"undefined"!=typeof entityId&&(viewItem.entityId=entityId),OSH.EventManager.fire(OSH.EventManager.EVENT.ADD_VIEW_ITEM,{viewItem:viewItem,viewId:viewId}),OSH.EventManager.fire(OSH.EventManager.EVENT.CONNECT_DATASOURCE,{dataSourcesId:[gpsDataSource.id]})},createMJPEGVideoDialog:function(name,endPointUrl,offeringID,obsProp,startTime,endTime,syncMasterTime,entityId){var videoDataSource=new OSH.DataReceiver.VideoMjpeg(name,{protocol:"ws",service:"SOS",endpointUrl:endPointUrl,offeringID:offeringID,observedProperty:obsProp,startTime:startTime,endTime:endTime,replaySpeed:1,syncMasterTime:syncMasterTime,bufferingTime:1e3}),dialog=new OSH.UI.DialogView("dialog-main-container",{draggable:!1,css:"dialog",name:name,show:!0,dockable:!0,closeable:!0,connectionIds:[videoDataSource.id],swapId:this.swapId});new OSH.UI.MjpegView(dialog.popContentDiv.id,{dataSourceId:videoDataSource.id,css:"video",cssSelected:"video-selected",name:"Android Video",entityId:entityId});this.dataReceiverController.addDataSource(videoDataSource),OSH.EventManager.fire(OSH.EventManager.EVENT.CONNECT_DATASOURCE,{dataSourcesId:[videoDataSource.id]})},createH264VideoDialog:function(name,endPointUrl,offeringID,obsProp,startTime,endTime,syncMasterTime,entityId){var videoDataSource=new OSH.DataReceiver.VideoH264(name,{protocol:"ws",service:"SOS",endpointUrl:endPointUrl,offeringID:offeringID,observedProperty:obsProp,startTime:startTime,endTime:endTime,replaySpeed:1,syncMasterTime:syncMasterTime,bufferingTime:1e3}),dialog=new OSH.UI.DialogView("dialog-main-container",{draggable:!1,css:"dialog",name:name,show:!0,dockable:!0,closeable:!0,connectionIds:[videoDataSource.id],swapId:this.swapId});new OSH.UI.FFMPEGView(dialog.popContentDiv.id,{dataSourceId:videoDataSource.getId(),css:"video",cssSelected:"video-selected",name:"Android Video",entityId:entityId});this.dataReceiverController.addDataSource(videoDataSource),OSH.EventManager.fire(OSH.EventManager.EVENT.CONNECT_DATASOURCE,{dataSourcesId:[videoDataSource.id]})},createChartDialog:function(name,endPointUrl,offeringID,obsProp,startTime,endTime,syncMasterTime,entityId){var chartDataSource=new OSH.DataReceiver.Chart(name,{protocol:"ws",service:"SOS",endpointUrl:endPointUrl,offeringID:offeringID,observedProperty:obsProp,startTime:startTime,endTime:endTime,replaySpeed:1,syncMasterTime:syncMasterTime,bufferingTime:1e3}),dialog=new OSH.UI.DialogView("dialog-main-container",{draggable:!1,css:"dialog",name:name,show:!0,dockable:!0,closeable:!0,connectionIds:[chartDataSource.id],swapId:this.swapId});new OSH.UI.Nvd3CurveChartView(dialog.popContentDiv.id,[{styler:new OSH.UI.Styler.Curve({valuesFunc:{dataSourceIds:[chartDataSource.getId()],handler:function(rec,timeStamp){return{x:timeStamp,y:parseFloat(rec[2])}}}})}],{name:name,yLabel:"",xLabel:"",css:"chart-view",cssSelected:"video-selected",maxPoints:30});this.dataReceiverController.addDataSource(chartDataSource),OSH.EventManager.fire(OSH.EventManager.EVENT.CONNECT_DATASOURCE,{dataSourcesId:[chartDataSource.id]})}}),OSH.UI.DiscoveryView.Type={MARKER_GPS:"Marker(GPS)",DIALOG_VIDEO_H264:"Video Dialog(H264)",DIALOG_VIDEO_MJPEG:"Video Dialog(MJPEG)",DIALOG_CHART:"Chart Dialog"},OSH.UI.OpenLayerView=OSH.UI.View.extend({initialize:function(divId,viewItems,options){this._super(divId,viewItems,options)},beforeAddingItems:function(options){this.initMap(options),options.map||this.initEvents()},initEvents:function(){document.getElementById(this.divId).oncontextmenu=function(e){new Object({keyCode:93});void 0!=e.preventDefault&&e.preventDefault(),void 0!=e.stopPropagation&&e.stopPropagation()};var self=this;this.map.getViewport().addEventListener("contextmenu",function(e){e.preventDefault();var feature=self.map.forEachFeatureAtPixel(self.map.getEventPixel(e),function(feature,layer){return feature});if(feature){var id=feature.ha;for(var stylerId in self.stylerToObj)if(self.stylerToObj[stylerId]==id){OSH.EventManager.fire(OSH.EventManager.EVENT.CONTEXT_MENU+"-"+self.stylerIdToStyler[stylerId].viewItem.contextMenuId,{offsetX:-70,offsetY:-70,action:"show",x:OSH.Utils.getXCursorPosition(),y:OSH.Utils.getYCursorPosition()});break}}}),this.map.on("click",function(e){self.map.forEachFeatureAtPixel(e.pixel,function(feature,layer){var id=feature.ha,dataSourcesIds=[];for(var stylerId in self.stylerToObj)if(self.stylerToObj[stylerId]==id){var styler=self.stylerIdToStyler[stylerId];OSH.EventManager.fire(OSH.EventManager.EVENT.SELECT_VIEW,{dataSourcesIds:dataSourcesIds.concat(styler.getDataSourcesIds()),entityId:styler.viewItem.entityId});break}})})},updateMarker:function(styler){var markerId=0;styler.getId()in this.stylerToObj?markerId=this.stylerToObj[styler.getId()]:(markerId=this.addMarker({lat:styler.location.y,lon:styler.location.x,orientation:styler.orientation.heading,color:styler.color,icon:styler.icon,name:this.names[styler.getId()]}),this.stylerToObj[styler.getId()]=markerId);var markerFeature=this.markers[markerId],lon=styler.location.x,lat=styler.location.y;if(!isNaN(lon)&&!isNaN(lat)){var coordinates=ol.proj.transform([lon,lat],"EPSG:4326","EPSG:900913");markerFeature.getGeometry().setCoordinates(coordinates)}if(null!=styler.icon){var iconStyle=new ol.style.Style({image:new ol.style.Icon({opacity:.75,src:styler.icon,rotation:styler.orientation.heading*Math.PI/180})});markerFeature.setStyle(iconStyle)}},updatePolyline:function(styler){var polylineId=0;if(styler.getId()in this.stylerToObj?polylineId=this.stylerToObj[styler.getId()]:(polylineId=this.addPolyline({color:styler.color,weight:styler.weight,locations:styler.locations,maxPoints:styler.maxPoints,opacity:styler.opacity,smoothFactor:styler.smoothFactor,name:this.names[styler.getId()]}),this.stylerToObj[styler.getId()]=polylineId),polylineId in this.polylines){for(var geometry=this.polylines[polylineId],polylinePoints=[],i=0;i<styler.locations.length;i++)polylinePoints.push(ol.proj.transform([styler.locations[i].x,styler.locations[i].y],"EPSG:4326","EPSG:900913"));geometry.setCoordinates(polylinePoints)}},initMap:function(options){var initialView=null;this.first=!0;var overlays=[],defaultLayer=null,baseLayers=this.getDefaultLayers();if(this.markers={},this.polylines={},"undefined"!=typeof options){var maxZoom=19;if(options.map)return void(this.map=options.map);options.maxZoom&&(maxZoom=options.maxZoom),options.initialView&&(initialView=new ol.View({center:ol.proj.transform([options.initialView.lon,options.initialView.lat],"EPSG:4326","EPSG:900913"),zoom:options.initialView.zoom,maxZoom:maxZoom})),options.autoZoomOnFirstMarker||(this.first=!1),options.overlayLayers&&(overlays=options.overlayLayers),options.baseLayers&&(baseLayers=options.baseLayers),options.defaultLayer&&(defaultLayer=options.defaultLayer)}else initialView=new ol.View({center:ol.proj.transform([0,0],"EPSG:4326","EPSG:900913"),zoom:11,maxZoom:maxZoom});this.map=new ol.Map({target:this.divId,controls:ol.control.defaults({attributionOptions:{collapsible:!1}}).extend([new ol.control.ZoomSlider,new ol.control.Rotate,new ol.control.ScaleLine]),interactions:ol.interaction.defaults().extend([new ol.interaction.Select({condition:ol.events.condition.mouseMove})]),layers:[new ol.layer.Group({title:"Base maps",layers:baseLayers}),new ol.layer.Group({title:"Overlays",layers:overlays})],view:initialView});var layerSwitcher=new ol.control.LayerSwitcher({tipLabel:"Layers"});this.map.addControl(layerSwitcher);var select_interaction=new ol.interaction.Select,self=this;select_interaction.getFeatures().on("add",function(e){var feature=e.element,memo=[];for(var styler in self.stylerToObj)if(self.stylerToObj[styler]==feature.getId())for(var i=0;i<self.stylers.length;i++)if(self.stylers[i].getId()==styler){memo=memo.concat(self.stylers[i].getDataSourcesIds());break}$(self.divId).fire("osh:select",memo)}),this.map.addInteraction(select_interaction)},getDefaultBaseLayers:function(){return{}},getDefaultLayers:function(){var osm=new ol.layer.Tile({title:"OSM",type:"base",visible:!0,source:new ol.source.OSM});return[osm]},addMarker:function(properties){var marker=new ol.geom.Point(ol.proj.transform([properties.lon,properties.lat],"EPSG:4326","EPSG:900913")),markerFeature=new ol.Feature({geometry:marker,name:"Marker"});if(null!=properties.icon){var iconStyle=new ol.style.Style({image:new ol.style.Icon({opacity:.75,src:properties.icon,rotation:properties.orientation*Math.PI/180})});markerFeature.setStyle(iconStyle)}var vectorMarkerLayer=new ol.layer.Vector({title:properties.name,source:new ol.source.Vector({features:[markerFeature]})});this.map.addLayer(vectorMarkerLayer);var id="view-marker-"+OSH.Utils.randomUUID();return markerFeature.setId(id),this.markers[id]=markerFeature,this.first&&(this.first=!1,this.map.getView().setCenter(ol.proj.transform([properties.lon,properties.lat],"EPSG:4326","EPSG:900913")),this.map.getView().setZoom(19)),id},createMarkerFromStyler:function(styler){if(styler.getId()in this.stylerToObj)return this.stylerToObj[styler.getId()];var properties={lat:styler.location.y,lon:styler.location.x,orientation:styler.orientation.heading,color:styler.color,icon:styler.icon,name:this.names[styler.getId()]},marker=new ol.geom.Point(ol.proj.transform([properties.lon,properties.lat],"EPSG:4326","EPSG:900913")),markerFeature=new ol.Feature({geometry:marker,name:"Marker"});if(null!=properties.icon){var iconStyle=new ol.style.Style({image:new ol.style.Icon({opacity:.75,src:properties.icon,rotation:properties.orientation*Math.PI/180})});markerFeature.setStyle(iconStyle)}var id="view-marker-"+OSH.Utils.randomUUID();return markerFeature.setId(id),this.markers[id]=markerFeature,this.stylerToObj[styler.getId()]=id,id},addPolyline:function(properties){for(var polylinePoints=[],i=0;i<properties.locations.length;i++)polylinePoints.push(ol.proj.transform([properties.locations[i].x,properties.locations[i].y],"EPSG:4326","EPSG:900913"));var pathGeometry=new ol.geom.LineString(polylinePoints),feature=new ol.Feature({geometry:pathGeometry,name:"Line"}),source=new ol.source.Vector({features:[feature]}),vectorPathLayer=new ol.layer.Vector({title:properties.name,source:source,style:new ol.style.Style({fill:new ol.style.Fill({color:properties.color}),stroke:new ol.style.Stroke({color:properties.color,width:properties.weight})})});this.map.addLayer(vectorPathLayer);var id="view-polyline-"+OSH.Utils.randomUUID();return this.polylines[id]=pathGeometry,id}}),OSH.UI.DialogView=OSH.UI.View.extend({initialize:function(divId,options){this._super(divId,[],options),this.dialogId="dialog-"+OSH.Utils.randomUUID(),this.pinDivId="dialog-pin-"+OSH.Utils.randomUUID();var closeDivId="dialog-close-"+OSH.Utils.randomUUID();this.connectDivId="dialog-connect-"+OSH.Utils.randomUUID(),this.name="Untitled";var htmlVar="";if(htmlVar+="<div>",this.dockable=!1,this.closeable=!1,this.connected=!1,this.swapped=!1,this.connectionIds=[],this.draggable=!1,isUndefined(options)||("undefined"!=typeof options.swapId&&""!=options.swapId&&(this.swapDivId="dialog-exchange-"+OSH.Utils.randomUUID(),htmlVar+='<a id="'+this.swapDivId+'"class="pop-exchange fa fa-exchange" title="swap"></a>',this.divIdToSwap=options.swapId),"undefined"!=typeof options.connectionIds&&"undefined"!=typeof options.connectionIds&&options.connectionIds.length>0&&(htmlVar+='<a id="'+this.connectDivId+'"class="pop-connect"></a>',this.connected=!0,this.connectionIds=options.connectionIds),"undefined"!=typeof options.dockable&&options.dockable&&(htmlVar+='<a id="'+this.pinDivId+'"class="pop-pin"></a>',this.dockable=options.dockable),"undefined"!=typeof options.closeable&&options.closeable&&(htmlVar+='<a id="'+closeDivId+'"class="pop-close" title="close">x</a>',this.closeable=options.closeable),"undefined"!=typeof options.draggable&&options.draggable&&(this.draggable=options.draggable),"undefined"!=typeof options.name&&(this.name=options.name)),this.titleId="dialog-title-"+OSH.Utils.randomUUID(),htmlVar+='<h3 id="'+this.titleId+'">'+this.name+"</h3></div>",this.rootTag=document.getElementById(this.divId),this.rootTag.innerHTML=htmlVar,this.rootTag.setAttribute("class","pop-over resizable"),this.rootTag.setAttribute("draggable",this.draggable),this.keepRatio=!1,!isUndefined(options)){var css=this.rootTag.className;options.css&&(css+=" "+options.css),options.keepRatio&&(css+=" keep-ratio-w",this.keepRatio=!0),this.rootTag.setAttribute("class",css)}this.flexDiv=document.createElement("div"),this.flexDiv.setAttribute("class","pop-inner"),this.popContentDiv=document.createElement("div"),this.popContentDiv.setAttribute("class","pop-content"),this.popContentDiv.setAttribute("id","pop-content-id-"+OSH.Utils.randomUUID()),this.keepRatio||OSH.Utils.addCss(this.popContentDiv,"no-keep-ratio"),this.flexDiv.appendChild(this.popContentDiv),this.rootTag.appendChild(this.flexDiv),"undefined"!=typeof options&&("undefined"==typeof options.show||options.show?this.initialWidth=this.rootTag.offsetWidth:this.rootTag.style.display="none"),this.rootTag.addEventListener("dragstart",this.drag_start.bind(this),!1),document.addEventListener("dragover",this.drag_over.bind(this),!1),document.addEventListener("drop",this.drop.bind(this),!1),this.closeable&&(document.getElementById(closeDivId).onclick=this.close.bind(this)),this.dockable&&(document.getElementById(this.pinDivId).onclick=this.unpin.bind(this)),this.connectionIds.length>0&&(document.getElementById(this.connectDivId).onclick=this.connect.bind(this)),"undefined"!=typeof this.swapDivId&&(document.getElementById(this.swapDivId).onclick=this.swapClick.bind(this)),this.handleEvents();var self=this;OSH.EventManager.observe(OSH.EventManager.EVENT.CONNECT_DATASOURCE,function(event){var dataSources=event.dataSourcesId;dataSources.length==self.connectionIds.length&&dataSources.filter(function(n){return self.connectionIds.indexOf(n)!=-1}).length==self.connectionIds.length&&(document.getElementById(self.connectDivId).setAttribute("class","pop-connect"),self.connected=!0)}),OSH.EventManager.observe(OSH.EventManager.EVENT.DISCONNECT_DATASOURCE,function(event){var dataSources=event.dataSourcesId;dataSources.length==self.connectionIds.length&&dataSources.filter(function(n){return self.connectionIds.indexOf(n)!=-1}).length==self.connectionIds.length&&(document.getElementById(self.connectDivId).setAttribute("class","pop-disconnect"),self.connected=!1)}),OSH.EventManager.observe("swap-restore",function(event){self.swapped&&event.exclude!=self.id&&(self.swap(),self.swapped=!1)});var p=this.rootTag.parentNode,testDiv=document.createElement("div");testDiv.setAttribute("class","outer-dialog"),testDiv.appendChild(this.rootTag),p.appendChild(testDiv)},swapClick:function(){OSH.EventManager.fire("swap-restore",{exclude:this.id}),this.swap()},swap:function(){var containerDivToSwap=document.getElementById(this.divIdToSwap);if("undefined"!=containerDivToSwap&&null!=containerDivToSwap){if(this.swapped){var popContent=this.popContentDiv.firstChild,swapContainerContent=document.getElementById(this.contentViewId);containerDivToSwap.removeChild(swapContainerContent),this.popContentDiv.removeChild(popContent),containerDivToSwap.appendChild(popContent),this.popContentDiv.appendChild(swapContainerContent),document.getElementById(this.titleId).innerText=this.name,this.swapped=!1,this.keepRatio&&(OSH.Utils.addCss(this.rootTag,"keep-ratio-w"),OSH.Utils.removeCss(this.popContentDiv,"no-keep-ratio"),OSH.Utils.removeCss(containerDivToSwap,"keep-ratio-h"))}else{var popContent=this.popContentDiv.firstChild;this.contentViewId=popContent.id;var swapContainerContent=containerDivToSwap.firstChild;containerDivToSwap.removeChild(swapContainerContent),this.popContentDiv.removeChild(popContent),containerDivToSwap.appendChild(popContent),this.popContentDiv.appendChild(swapContainerContent),this.swapped=!0,document.getElementById(this.titleId).innerText="- Swapped -",this.keepRatio&&(OSH.Utils.removeCss(this.rootTag,"keep-ratio-w"),OSH.Utils.addCss(this.popContentDiv,"no-keep-ratio"),OSH.Utils.addCss(containerDivToSwap,"keep-ratio-h"))}for(var everyChild=document.getElementById(this.divIdToSwap).querySelectorAll("div"),i=0;i<everyChild.length;i++){var id=everyChild[i].id;id.startsWith("view-")&&OSH.EventManager.fire(OSH.EventManager.EVENT.RESIZE+"-"+id)}for(var everyChild=this.popContentDiv.querySelectorAll("div"),i=0;i<everyChild.length;i++){var id=everyChild[i].id;id.startsWith("view-")&&OSH.EventManager.fire(OSH.EventManager.EVENT.RESIZE+"-"+id)}}},show:function(properties){properties.viewId.indexOf(this.getId())>-1&&(this.rootTag.style.display="block","undefined"==typeof this.initialWidth&&(this.initialWidth=this.rootTag.offsetWidth))},connect:function(){this.swapped||(this.connected?OSH.EventManager.fire(OSH.EventManager.EVENT.DISCONNECT_DATASOURCE,{dataSourcesId:this.connectionIds}):OSH.EventManager.fire(OSH.EventManager.EVENT.CONNECT_DATASOURCE,{dataSourcesId:this.connectionIds}))},unpin:function(){if(this.draggable)this.rootTag.style.top=0,this.rootTag.style.left=0-(this.rootTag.offsetWidth-this.initialWidth),this.rootTag.style.position="relative",this.rootTag.setAttribute("draggable",!1),document.body.removeChild(this.rootTag),this.container.appendChild(this.rootTag),this.draggable=!1,document.getElementById(this.pinDivId).setAttribute("class","pop-pin");else{var bodyRect=document.body.getBoundingClientRect(),elemRect=this.rootTag.getBoundingClientRect(),offsetTop=elemRect.top-bodyRect.top,offsetLeft=elemRect.left-bodyRect.left;this.rootTag.setAttribute("draggable",!0),this.rootTag.parentNode.removeChild(this.rootTag),document.body.appendChild(this.rootTag),this.rootTag.style.top=offsetTop,this.rootTag.style.left=offsetLeft,this.rootTag.style.position="absolute",this.draggable=!0,document.getElementById(this.pinDivId).setAttribute("class","pop-pin pop-pin-drag")}},onClose:function(callback){this.onClose=callback},close:function(){this.rootTag.style.display="none",this.onClose&&this.onClose()},drag_start:function(event){event.stopPropagation();var style=window.getComputedStyle(event.target,null);event.dataTransfer.effectAllowed="all",event.dataTransfer.setData("text-"+this.rootTag.id,parseInt(style.getPropertyValue("left"),10)-event.clientX+","+(parseInt(style.getPropertyValue("top"),10)-event.clientY))},drag_over:function(event){return event.stopPropagation(),event.preventDefault(),!1},drop:function(event){event.stopPropagation();var offset=event.dataTransfer.getData("text-"+this.rootTag.id).split(",");return this.rootTag.style.left=100*(event.clientX+parseInt(offset[0],10))/window.innerWidth+"%",this.rootTag.style.top=event.clientY+parseInt(offset[1],10)+"px",event.preventDefault(),!1}}),OSH.UI.MultiDialogView=OSH.UI.DialogView.extend({initialize:function(divId,options){this._super(divId,options),this.popExtraDiv=document.createElement("div"),this.popExtraDiv.setAttribute("class","pop-extra"),this.popExtraDiv.setAttribute("id","pop-extra-id-"+OSH.Utils.randomUUID()),this.flexDiv.appendChild(this.popExtraDiv)},appendView:function(divId,properties){var divToAdd=document.getElementById(divId);"none"===divToAdd.style.display&&(divToAdd.style.display="block");var extraDiv=document.createElement("div");extraDiv.setAttribute("class","pop-extra-el");var i=document.createElement("i");i.setAttribute("class","fa fa-caret-right pop-extra-collapse"),i.onclick=function(){i.className.indexOf("fa-caret-down")==-1?i.className="fa fa-caret-down pop-extra-show":i.className="fa fa-caret-right pop-extra-collapse"},extraDiv.appendChild(i),extraDiv.appendChild(divToAdd),this.popExtraDiv.appendChild(extraDiv)},swap:function(){var currentSwapValue=this.swapped;this._super(),currentSwapValue?this.popExtraDiv.style.display="block":this.popExtraDiv.style.display="none"},show:function(properties){this._super(properties)}}),OSH.UI.Loading=BaseClass.extend({initialize:function(){var loadingDiv=document.createElement("div");loadingDiv.setAttribute("class","loading-container"),OSH.EventManager.observe(OSH.EventManager.EVENT.LOADING_START,function(event){var htmlVar="";htmlVar+='\t<div class="loading-dot-container">',htmlVar+='\t<div class="loading-dot-section-1"><span class="loading-label">Buffering</span></div>',htmlVar+='\t<div class="loading-dot-section-2">',htmlVar+='\t<div class="loading-dot"></div>',htmlVar+='\t<div class="loading-dot"></div>',htmlVar+='\t<div class="loading-dot"></div>',htmlVar+="\t</div>",htmlVar+="\t</div>",loadingDiv.innerHTML=htmlVar,document.body.appendChild(loadingDiv)}),OSH.EventManager.observe(OSH.EventManager.EVENT.LOADING_STOP,function(event){document.body.removeChild(loadingDiv)})}}),new OSH.UI.Loading;var htmlTaskingComponent="";htmlTaskingComponent+='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="-2 -2 504 504" id="menu" style="transform-origin: 50% 50% 0px; transform: translate3d(0px, 0px, 0px); touch-action: none; -webkit-user-select: none;">',htmlTaskingComponent+='<g id="symbolsContainer">    <symbol class="icon icon-" id="icon-1" viewBox="0 0 59 59"><!--Replace the contents of this symbol with the content of your icon--><rect fill="none" stroke="#111" stroke-width="1" width="100%" height="100%"></rect><text fill="#222" x="50%" y="50%" dy=".3em" text-anchor="middle" font-size="1.2em">1</text></symbol>',htmlTaskingComponent+='    <symbol class="icon icon-" id="icon-2" viewBox="0 0 59 59"><!--Replace the contents of this symbol with the content of your icon--><rect fill="none" stroke="#111" stroke-width="1" width="100%" height="100%"></rect><text fill="#222" x="50%" y="50%" dy=".3em" text-anchor="middle" font-size="1.2em">2</text></symbol>',htmlTaskingComponent+='    <symbol class="icon icon-" id="icon-3" viewBox="0 0 59 59"><!--Replace the contents of this symbol with the content of your icon--><rect fill="none" stroke="#111" stroke-width="1" width="100%" height="100%"></rect><text fill="#222" x="50%" y="50%" dy=".3em" text-anchor="middle" font-size="1.2em">3</text></symbol>',htmlTaskingComponent+='    <symbol class="icon icon-" id="icon-4" viewBox="0 0 59 59"><!--Replace the contents of this symbol with the content of your icon--><rect fill="none" stroke="#111" stroke-width="1" width="100%" height="100%"></rect><text fill="#222" x="50%" y="50%" dy=".3em" text-anchor="middle" font-size="1.2em">4</text></symbol>',
htmlTaskingComponent+='    <symbol class="icon icon-" id="icon-5" viewBox="0 0 59 59"><!--Replace the contents of this symbol with the content of your icon--><rect fill="none" stroke="#111" stroke-width="1" width="100%" height="100%"></rect><text fill="#222" x="50%" y="50%" dy=".3em" text-anchor="middle" font-size="1.2em">5</text></symbol>',htmlTaskingComponent+='    <symbol class="icon icon-" id="icon-6" viewBox="0 0 59 59"><!--Replace the contents of this symbol with the content of your icon--><rect fill="none" stroke="#111" stroke-width="1" width="100%" height="100%"></rect><text fill="#222" x="50%" y="50%" dy=".3em" text-anchor="middle" font-size="1.2em">6</text></symbol>',htmlTaskingComponent+='    <symbol class="icon icon-" id="icon-7" viewBox="0 0 59 59"><!--Replace the contents of this symbol with the content of your icon--><rect fill="none" stroke="#111" stroke-width="1" width="100%" height="100%"></rect><text fill="#222" x="50%" y="50%" dy=".3em" text-anchor="middle" font-size="1.2em">7</text></symbol>',htmlTaskingComponent+='    <symbol class="icon icon-" id="icon-8" viewBox="0 0 59 59"><!--Replace the contents of this symbol with the content of your icon--><rect fill="none" stroke="#111" stroke-width="1" width="100%" height="100%"></rect><text fill="#222" x="50%" y="50%" dy=".3em" text-anchor="middle" font-size="1.2em">8</text></symbol>',htmlTaskingComponent+="</g>",htmlTaskingComponent+='<g id="itemsContainer">        <a class="item" id="item-1" role="link" tabindex="0" xlink:href=" " xlink:title=" " transform="matrix(1,0,0,1,0,0)" data-svg-origin="250 250" style=""><path fill="none" stroke="#111" d="M380,250 l120,0 A250,250 0 0,0 426.7766952966369,73.22330470336314 l-84.8528137423857,84.85281374238568 A130,130 0 0,1 380,250" class="sector"></path><use xlink:href="#icon-1" width="59" height="59" x="392.3415832519531" y="149.3208770751953" transform="rotate(67.5 421.8415832519531 178.8208770751953)"></use></a>',htmlTaskingComponent+='        <a class="item" id="item-2" role="link" tabindex="0" xlink:href=" " xlink:title=" " transform="matrix(0.7071,-0.7071,0.7071,0.7071,-103.55339059327378,249.99999999999997)" data-svg-origin="250 250" style=""><path fill="none" stroke="#111" d="M380,250 l120,0 A250,250 0 0,0 426.7766952966369,73.22330470336314 l-84.8528137423857,84.85281374238568 A130,130 0 0,1 380,250" class="sector"></path><use xlink:href="#icon-2" width="59" height="59" x="392.3415832519531" y="149.3208770751953" transform="rotate(67.5 421.8415832519531 178.8208770751953)"></use></a>',htmlTaskingComponent+='        <a class="item" id="item-3" role="link" tabindex="0" xlink:href=" " xlink:title=" " transform="matrix(0,-1,1,0,0,500)" data-svg-origin="250 250" style=""><path fill="none" stroke="#111" d="M380,250 l120,0 A250,250 0 0,0 426.7766952966369,73.22330470336314 l-84.8528137423857,84.85281374238568 A130,130 0 0,1 380,250" class="sector"></path><use xlink:href="#icon-3" width="59" height="59" x="392.3415832519531" y="149.3208770751953" transform="rotate(67.5 421.8415832519531 178.8208770751953)"></use></a>',htmlTaskingComponent+='        <a class="item" id="item-4" role="link" tabindex="0" xlink:href=" " xlink:title=" " transform="matrix(-0.7071,-0.7071,0.7071,-0.7071,249.99999999999997,603.5533905932738)" data-svg-origin="250 250" style=""><path fill="none" stroke="#111" d="M380,250 l120,0 A250,250 0 0,0 426.7766952966369,73.22330470336314 l-84.8528137423857,84.85281374238568 A130,130 0 0,1 380,250" class="sector"></path><use xlink:href="#icon-4" width="59" height="59" x="392.3415832519531" y="149.3208770751953" transform="rotate(67.5 421.8415832519531 178.8208770751953)"></use></a>',htmlTaskingComponent+='        <a class="item" id="item-5" role="link" tabindex="0" xlink:href=" " xlink:title=" " transform="matrix(-1,0,0,-1,500,500)" data-svg-origin="250 250" style=""><path fill="none" stroke="#111" d="M380,250 l120,0 A250,250 0 0,0 426.7766952966369,73.22330470336314 l-84.8528137423857,84.85281374238568 A130,130 0 0,1 380,250" class="sector"></path><use xlink:href="#icon-5" width="59" height="59" x="392.3415832519531" y="149.3208770751953" transform="rotate(67.5 421.8415832519531 178.8208770751953)"></use></a>',htmlTaskingComponent+='        <a class="item" id="item-6" role="link" tabindex="0" xlink:href=" " xlink:title=" " transform="matrix(-0.7071,0.7071,-0.7071,-0.7071,603.5533905932738,250.00000000000006)" data-svg-origin="250 250" style=""><path fill="none" stroke="#111" d="M380,250 l120,0 A250,250 0 0,0 426.7766952966369,73.22330470336314 l-84.8528137423857,84.85281374238568 A130,130 0 0,1 380,250" class="sector"></path><use xlink:href="#icon-6" width="59" height="59" x="392.3415832519531" y="149.3208770751953" transform="rotate(67.5 421.8415832519531 178.8208770751953)"></use></a>',htmlTaskingComponent+='        <a class="item" id="item-7" role="link" tabindex="0" xlink:href=" " xlink:title=" " transform="matrix(0,1,-1,0,500.00000000000006,0)" data-svg-origin="250 250" style=""><path fill="none" stroke="#111" d="M380,250 l120,0 A250,250 0 0,0 426.7766952966369,73.22330470336314 l-84.8528137423857,84.85281374238568 A130,130 0 0,1 380,250" class="sector"></path><use xlink:href="#icon-7" width="59" height="59" x="392.3415832519531" y="149.3208770751953" transform="rotate(67.5 421.8415832519531 178.8208770751953)"></use></a>',htmlTaskingComponent+='        <a class="item" id="item-8" role="link" tabindex="0" xlink:href=" " xlink:title=" " transform="matrix(0.7071,0.7071,-0.7071,0.7071,250.00000000000009,-103.55339059327378)" data-svg-origin="250 250" style=""><path fill="none" stroke="#111" d="M380,250 l120,0 A250,250 0 0,0 426.7766952966369,73.22330470336314 l-84.8528137423857,84.85281374238568 A130,130 0 0,1 380,250" class="sector"></path><use xlink:href="#icon-8" width="59" height="59" x="392.3415832519531" y="149.3208770751953" transform="rotate(67.5 421.8415832519531 178.8208770751953)"></use></a>',htmlTaskingComponent+="</g>",htmlTaskingComponent+='<g id="trigger" class="trigger menu-trigger" role="button">',htmlTaskingComponent+='<circle cx="250" cy="250" r="60"></circle>',htmlTaskingComponent+="</g>",htmlTaskingComponent+="</svg>",OSH.UI.PtzTaskingView=OSH.UI.View.extend({initialize:function(divId,options){this._super(divId,[],options);var width="640",height="480";this.css="",this.cssSelected="","undefined"!=typeof options&&(options.width&&(width=options.width),options.height&&(height=options.height),options.css&&(this.css=options.css),options.cssSelected&&(this.cssSelected=options.cssSelected)),this.rootTag=document.createElement("div"),this.rootTag.setAttribute("height",height),this.rootTag.setAttribute("width",width),this.rootTag.setAttribute("class",this.css),this.rootTag.setAttribute("id","dataview-"+OSH.Utils.randomUUID()),document.getElementById(this.divId).appendChild(this.rootTag),this.rootTag.innerHTML=htmlTaskingComponent,this.observers=[],this.pan=0,this.tilt=0,this.zoom=0},removeInterval:function(interval){this.timerIds.length>0&&setTimeout(clearInterval(this.timerIds.pop()),interval+50)},onTiltClick:function(value){this.tilt+=value,this.onChange(0,value,0)},onPanClick:function(value){this.pan+=value,this.onChange(value,0,0)},onZoomClick:function(value){this.zoom+=value,this.onChange(0,0,value)},onChange:function(rpan,rtilt,rzoom){for(var properties={pan:rpan,zoom:rzoom,tilt:rtilt},i=0;i<this.observers.length;i++)this.observers[i].sendRequest(properties)},register:function(observer){this.observers.push(observer)}}),OSH.UI.MjpegView=OSH.UI.View.extend({initialize:function(divId,options){this._super(divId,[],options),this.imgTag=document.createElement("img"),this.imgTag.setAttribute("id","dataview-"+OSH.Utils.randomUUID()),document.getElementById(this.divId).appendChild(this.imgTag);var self=this;OSH.EventManager.observeDiv(this.divId,"click",function(event){OSH.EventManager.fire(OSH.EventManager.EVENT.SELECT_VIEW,{dataSourcesIds:[self.dataSourceId],entityId:self.entityId})})},setData:function(dataSourceId,data){var oldBlobURL=this.imgTag.src;this.imgTag.src=data.data,window.URL.revokeObjectURL(oldBlobURL)},selectDataView:function(dataSourceIds,entityId){dataSourceIds.indexOf(this.dataSourceId)>-1||"undefined"!=typeof this.entityId&&this.entityId==entityId?document.getElementById(this.divId).setAttribute("class",this.css+" "+this.cssSelected):document.getElementById(this.divId).setAttribute("class",this.css)},reset:function(){this.imgTag.src=""}}),OSH.UI.Mp4View=OSH.UI.View.extend({initialize:function(divId,options){this._super(divId,[],options);this.codecs="avc1.64001E","undefined"!=typeof options&&(options.css&&(this.css=options.css),options.codecs&&(this.codecs=options.codecs)),this.video=document.createElement("video"),this.video.setAttribute("control",""),document.getElementById(this.divId).appendChild(this.video);var self=this;OSH.EventManager.observeDiv(this.divId,"click",function(event){OSH.EventManager.fire(OSH.EventManager.EVENT.SELECT_VIEW,{dataSourcesIds:[self.dataSourceId],entityId:self.entityId})}),this.mediaSource=new MediaSource,this.buffer=null,this.queue=[],this.video.src=window.URL.createObjectURL(this.mediaSource),this.mediaSource.addEventListener("sourceopen",function(e){this.mediaSource.duration=1e7,this.video.play(),this.buffer=this.mediaSource.addSourceBuffer('video/mp4; codecs="'+this.codecs+'"');this.mediaSource;this.buffer.addEventListener("updatestart",function(e){this.queue.length>0&&!this.buffer.updating&&this.buffer.appendBuffer(this.queue.shift())}.bind(this)),this.buffer.addEventListener("updateend",function(e){}),this.buffer.addEventListener("error",function(e){}),this.buffer.addEventListener("abort",function(e){}),this.buffer.addEventListener("update",function(){this.queue.length>0&&!this.buffer.updating&&this.buffer.appendBuffer(this.queue.shift())}.bind(this))}.bind(this),!1);this.mediaSource;this.mediaSource.addEventListener("sourceopen",function(e){}),this.mediaSource.addEventListener("sourceended",function(e){}),this.mediaSource.addEventListener("sourceclose",function(e){}),this.mediaSource.addEventListener("error",function(e){})},setData:function(dataSourceId,data){this.buffer.updating||this.queue.length>0?this.queue.push(data.data):this.buffer.appendBuffer(data.data)},selectDataView:function(dataSourceIds,entityId){dataSourceIds.indexOf(this.dataSourceId)>-1||"undefined"!=typeof this.entityId&&this.entityId==entityId?document.getElementById(this.divId).setAttribute("class",this.css+" "+this.cssSelected):document.getElementById(this.divId).setAttribute("class",this.css)}});